/**
 * Created by zhangqi on 16/10/9.
 * 
 * IFlyIatSession-1.0.0
 */
var IFlyIatSession = function (u, p) {
    var n, a, e, r, m = {
        serverUrl: "wss://h5.openspeech.cn/iat.do",
        recordWorkerPath: null,
        vadWorkerPath: null,
        speexWorkerPath: null,
        useVad: !0
    }, l = {
        id: null,
        synId: 0
    }, S = !1, d = "", E = null, t = null, h = {
        source: null,
        scriptNode: null
    }, b = "", C = null, M = {
        browserId: null,
        bufferSize: null,
        host: null,
        isSupport: !0
    }, A = null, w = null, F = null, v = [], g = (n = {
        ver: "5.0.0.1048",
        sub: "iat",
        cmd: "",
        msg: "request"
    },
        a = function (e) {
            return JSON.parse(JSON.stringify(e))
        }
        ,
        {
            sessionBegin: function () {
                var e = a(n);
                e.cmd = "ssb",
                    e.data = {
                        params: b
                    },
                    y.send(e)
            },
            audioWrite: function (e, r) {
                null == e && x.log("can't send worker on session begin");
                var t = a(n);
                t.sid = e,
                    t.cmd = "auw",
                    t.data = r,
                    y.send(t)
            },
            getResult: function (e) {
                var r = a(n);
                r.cmd = "grs",
                    null != C && (r.nextsub = "nlp"),
                    r.sid = e,
                    y.send(r)
            },
            sessionEnd: function (e) {
                var r = a(n);
                r.cmd = "sse",
                    r.sid = e,
                    y.send(r)
            }
        }), I = {
            idle: "idle",
            sessionBegin: "ssb",
            audioWrite: "auw",
            getResult: "grs",
            sessionEnd: "sse"
        }, R = {
            onResult: function (e, r) { },
            onVolume: function () { },
            onError: function (e) { },
            onProcess: function (e) { }
        }, y = null, x = {
            log: function (e, r) {
                0 < r && console.log(e)
            },
            base64encode: function (e) {
                var r, t, n, a, o, s, i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
                for (n = e.length,
                    t = 0,
                    r = ""; t < n;) {
                    if (a = 255 & e.charCodeAt(t++),
                        t == n) {
                        r += i.charAt(a >> 2),
                            r += i.charAt((3 & a) << 4),
                            r += "==";
                        break
                    }
                    if (o = e.charCodeAt(t++),
                        t == n) {
                        r += i.charAt(a >> 2),
                            r += i.charAt((3 & a) << 4 | (240 & o) >> 4),
                            r += i.charAt((15 & o) << 2),
                            r += "=";
                        break
                    }
                    s = e.charCodeAt(t++),
                        r += i.charAt(a >> 2),
                        r += i.charAt((3 & a) << 4 | (240 & o) >> 4),
                        r += i.charAt((15 & o) << 2 | (192 & s) >> 6),
                        r += i.charAt(63 & s)
                }
                return r
            },
            getBufferSize: function () {
                var e = p.userAgent;
                return /(Win(dows )?NT 6\.2)/.test(e) ? 1024 : /(Win(dows )?NT 6\.1)/.test(e) ? 1024 : /(Win(dows )?NT 6\.0)/.test(e) ? 2048 : /Win(dows )?(NT 5\.1|XP)/.test(e) ? 4096 : /Mac|PPC/.test(e) ? 1024 : /Linux/.test(e) ? 8192 : /iPhone|iPad|iPod/.test(e) ? 2048 : 16384
            },
            checkIsSupport: function () {
                return !!p.mediaDevices.getUserMedia && (!!u.AudioContext && (!!u.Worker && !!u.URL))
            },
            extend: function (e, r) {
                var t, n = {};
                for (t in e)
                    Object.prototype.hasOwnProperty.call(e, t) && (n[t] = e[t]);
                for (t in r)
                    Object.prototype.hasOwnProperty.call(r, t) && (n[t] = r[t]);
                return n
            },
            getBrowserId: function () {
                "function" == typeof Fingerprint2 ? (new Fingerprint2).get(function (e) {
                    M.browserId = e
                }) : M.browserId = "unknow:" + btoa(p.userAgent).substr(0, 16)
            },
            checkParam: function (e, r) {
                if ("string" == typeof r) {
                    var t = r.split(",");
                    r = new Object;
                    for (var n = 0; n < t.length; n++) {
                        var a = t[n].split("=");
                        r[a[0]] = a[1]
                    }
                }
                return e in r
            }
        }, B = (r = function () {
            e(),
                d = I.sessionEnd,
                z()
        }
            ,
            {
                startRecord: function () {
                    if (null == E)
                        return H(),
                            void A.init();
                    R.onProcess("onStart"),
                        y.connect(),
                        d = I.sessionBegin,
                        S = !0,
                        V.start(),
                        A.reset(),
                        m.useVad && F.init(),
                        w.init()
                },
                getResult: function () {
                    e(),
                        d == I.audioWrite && (N.sendEnd(),
                            R.onProcess("onStop"),
                            d = I.getResult),
                        d == I.getResult ? g.getResult(l.id) : (r(),
                            R.onError("进程错误"))
                },
                stopRecord: e = function () {
                    S = !1,
                        V.stop()
                }
                ,
                abortSession: r
            });
    function z() {
        d == I.sessionEnd && null != l.id ? g.sessionEnd(l.id) : R.onProcess("onEnd"),
            d = I.idle
    }
    var s, i, o, c, _, f, k, L, P, N = (s = [],
        i = 0,
        o = function () {
            return d != I.getResult && null != l.id
        }
        ,
        c = function () {
            var o = 43 * s.length
                , e = function () {
                    var e, r, t = s.splice(0, s.length), n = new Int8Array(o);
                    for (e = 0; e < t.length; e++)
                        r = new Int8Array(t[e]),
                            n.set(r, 43 * e);
                    var a = "";
                    for (e = 0; e < o; e++)
                        a += String.fromCharCode(n[e]);
                    return a
                } ();
            l.synId++;
            var r = {
                synid: "" + l.synId,
                audiolen: "" + o,
                audiostatu: "2",
                audio: x.base64encode(e)
            };
            g.audioWrite(l.id, r),
                i = 0
        }
        ,
        {
            sendData: function (e) {
                if (o()) {
                    if (d = I.audioWrite,
                        i < 6)
                        return r = e,
                            s.push(r),
                            void i++;
                    var r;
                    c()
                }
            },
            sendEnd: function () {
                var e;
                o() && (c(),
                    e = {
                        synid: "" + l.synId,
                        audiolen: "0",
                        audiostatu: "4",
                        audio: ""
                    },
                    g.audioWrite(l.id, e),
                    l.synId = 0)
            }
        }), D = function (e) {
            E = e,
                h.source = t.createMediaStreamSource(e),
                h.scriptNode = t.createScriptProcessor(M.bufferSize, 1, 1),
                A.init(t.sampleRate),
                h.scriptNode.onaudioprocess = function (e) {
                    S && A.sendData(e.inputBuffer.getChannelData(0))
                }
                ,
                h.source.connect(h.scriptNode),
                h.scriptNode.connect(t.destination),
                B.startRecord()
        }, H = function () {
            null == t && (t = new u.AudioContext),
                t.resume && t.resume(),
                p.mediaDevices.getUserMedia({
                    audio: !0,
                    video: 0
                }).then(D, function (e) {
                    B.abortSession(),
                        R.onError("initMediaError")
                })
        }, V = (k = !1,
            L = f = _ = 0,
            P = function () {
                !k && _ < 8 ? 5 <= ++L && (k = !0,
                    R.onProcess("lowVolume")) : (k && 8 <= _ && R.onProcess("normalVolume"),
                        8 <= _ && (clearInterval(f),
                            L = 0))
            }
            ,
            {
                start: function () {
                    k = !1,
                        L = _ = 0,
                        f = setInterval(P, 500)
                },
                stop: function () {
                    clearInterval(f)
                },
                listen: function (e) {
                    _ = Math.max(_, e)
                }
            });
    return function (e) {
        var r, s, t, n, a, o, i, c, _, f;
        (R = x.extend(R, e.callback),
            m = x.extend(m, e.params),
            function () {
                p.getUserMedia = p.getUserMedia || p.webkitGetUserMedia || p.mozGetUserMedia || p.msGetUserMedia,
                    u.AudioContext = u.AudioContext || u.webkitAudioContext || u.mozAudioContext || u.msAudioContext,
                    u.URL = u.URL || u.webkitURL;
                void 0 === p.mediaDevices && (p.mediaDevices = {}),
                    void 0 === p.mediaDevices.getUserMedia && (p.mediaDevices.getUserMedia = function (t, e, r) {
                        return p.getUserMedia ? new Promise(function (e, r) {
                            p.getUserMedia.call(p, t, e, r)
                        }
                        ) : Promise.reject(new Error("getUserMedia is not implemented in this browser"))
                    }
                    ),
                    x.getBrowserId(),
                    M.host = u.document.domain,
                    M.bufferSize = x.getBufferSize(),
                    M.isSupport = x.checkIsSupport()
            } (),
            this.isSupport = function () {
                return M.isSupport
            }
            ,
            M.isSupport) && (m.recordWorkerPath = u.URL.createObjectURL(new Blob(['var sampleRate,outputBufferLength,recBuffers=[];function init(t){sampleRate=t.sampleRate,outputBufferLength=t.outputBufferLength}function reset(){recBuffers=[]}function record(t){var e,r=new Resampler(sampleRate,16e3,1,outputBufferLength,!0),s=[];for(e=0;e<t.length;e++)s.push(t[e]);var i=r.resampler(s),a=new Float32Array(i);for(e=0;e<i;e++)a[e]=r.outputBuffer[e];var n=floatTo16BitPCM(a);for(e=0;e<n.length;e++)recBuffers.push(n[e]);for(;320<recBuffers.length;){var h=recBuffers.splice(0,320),f=new Int16Array(h),o=getVolume(f);this.postMessage({volume:o,buffer:f})}}onmessage=function(t){switch(t.data.command){case"init":init(t.data.config);break;case"record":record(t.data.buffer);break;case"reset":reset()}};var getVolume=function(t){var r,s,e=[329,421,543,694,895,1146,1476,1890,2433,3118,4011,5142,6612,8478,10900,13982,17968,23054,29620,38014,48828,62654,80491,103294,132686,170366,218728,280830];return r=function(t){if(null==t||t.byteLength<=2)return 0;var e,r=0;for(e=0;e<t.length;e++)r+=t[e];r/=t.length;var s=0;for(e=0;e<t.length;e++)s+=parseInt(Math.pow(t[e]-r,2))>>9;return s/=t.length,parseInt(s)}(t),s=30,e.every(function(t,e){return!(r<t&&(s=e,1))}),s};function floatTo16BitPCM(t){for(var e=new Int16Array(t.length),r=0;r<t.length;r++){var s=Math.max(-1,Math.min(1,t[r]));e[r]=s<0?32768*s:32767*s}return e}function Resampler(t,e,r,s,i){this.fromSampleRate=t,this.toSampleRate=e,this.channels=0|r,this.outputBufferSize=s,this.noReturn=!!i,this.initialize()}Resampler.prototype.initialize=function(){if(!(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels))throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.lastWeight=1,this.resampler=this.compileLinearInterpolation):(this.tailExists=!1,this.lastWeight=0,this.resampler=this.compileMultiTap),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers())},Resampler.prototype.compileLinearInterpolation=function(t){var e=t.length,r=this.outputBufferSize;if(e%this.channels==0){if(0<e){for(var s,i=this.ratioWeight,a=this.lastWeight,n=0,h=0,f=0,o=this.outputBuffer;a<1;a+=i)for(n=1-(h=a%1),s=0;s<this.channels;++s)o[f++]=this.lastOutput[s]*n+t[s]*h;for(a--,e-=this.channels,sourceOffset=Math.floor(a)*this.channels;f<r&&sourceOffset<e;){for(n=1-(h=a%1),s=0;s<this.channels;++s)o[f++]=t[sourceOffset+s]*n+t[sourceOffset+this.channels+s]*h;a+=i,sourceOffset=Math.floor(a)*this.channels}for(s=0;s<this.channels;++s)this.lastOutput[s]=t[sourceOffset++];return this.lastWeight=a%1,this.bufferSlice(f)}return this.noReturn?0:[]}throw new Error("Buffer was of incorrect sample length.")},Resampler.prototype.compileMultiTap=function(t){var e=[],r=t.length,s=this.outputBufferSize;if(r%this.channels==0){if(0<r){for(var i=this.ratioWeight,a=0,n=0;n<this.channels;++n)e[n]=0;var h=0,f=0,o=!this.tailExists;this.tailExists=!1;var u=this.outputBuffer,l=0,p=0;do{if(o)for(a=i,n=0;n<this.channels;++n)e[n]=0;else{for(a=this.lastWeight,n=0;n<this.channels;++n)e[n]+=this.lastOutput[n];o=!0}for(;0<a&&h<r;){if(!((f=1+h-p)<=a)){for(n=0;n<this.channels;++n)e[n]+=t[h+n]*a;p+=a,a=0;break}for(n=0;n<this.channels;++n)e[n]+=t[h++]*f;p=h,a-=f}if(0!=a){for(this.lastWeight=a,n=0;n<this.channels;++n)this.lastOutput[n]=e[n];this.tailExists=!0;break}for(n=0;n<this.channels;++n)u[l++]=e[n]/i}while(h<r&&l<s);return this.bufferSlice(l)}return this.noReturn?0:[]}throw new Error("Buffer was of incorrect sample length.")},Resampler.prototype.bypassResampler=function(t){return this.noReturn?(this.outputBuffer=t).length:t},Resampler.prototype.bufferSlice=function(e){if(this.noReturn)return e;try{return this.outputBuffer.subarray(0,e)}catch(t){try{return this.outputBuffer.length=e,this.outputBuffer}catch(t){return this.outputBuffer.slice(0,e)}}},Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(t){this.outputBuffer=[],this.lastOutput=[]}};'], {
                type: "text/javascript"
            })),
                m.vadWorkerPath = u.URL.createObjectURL(new Blob(['function log(_){postMessage({type:"debug",message:_})}onmessage=function(_){switch(log(_.data),_.data.command){case"init":Vad();break;case"appendData":AppendData(_.data.pcmData,_.data.nSamples)}};var m_iVADState,m_s32ESil,m_s32ELow,m_s32EHigh,m_s32EMax,m_latestVolume,m_pPCMBuffer,m_iPCMStart,m_iPCMEnd,m_pPCMFrame,m_ppPCM,m_iFrameEnd,m_pFrameEnergy,m_iFrameHead,m_iFrameCheck,m_iSpeechBegin,m_iSpeechEnd,m_iSpeechEnd2,m_iFrameCurrent,m_nCheckEndFrame,ESVadStatus={ESVAD_SILENCE:0,ESVAD_CHECK_BEGIN:1,ESVAD_ACTIVE:2,ESVAD_CHECK_END:3,ESVAD_INACTIVE:4},ESVAD_DISABLE=0,ES_CMN_UPDATE_RATE=46,ES_CMN_UPDATE_RATE_C0=12,ESR_PCMBUFFER_SIZE=163840,ESR_FRAME_SIZE=200,ESR_FRAME_STEP=80,ESR_BACK_FRAMES=129,ESR_MAX_RESULT=16,RECORD_SAMPLESPERFRAME_DEF=200,ESIL_CHKBG_FRAMENUM=3,ELOW_CHKBG_FRAMENUM=20,EHIGH_CHKBG_FRAMENUM=20,EHIGH_CHKEND_FRAMENUM_SHORT=200,EHIGH_CHKEND_FRAMENUM_LONG=80,ELOW_CHKEND_FRAMENUM=60,ESR_FRAME_MAXNUM=ESR_BACK_FRAMES,ESR_MFCCFRAME_MAXNUM=9,MINIMUM_SPEECH_FRAMENUM=18,ELOW_VALIDREQ_THRESH=5,EHIGH_VALIDREQ_THRESH=4,EHIGH_ENDVALID_THRESH=3,ELOW_ENDVALID_THRESH=10,SPEECH_BEGIN_MARGIN=25,SPEECH_END_MARGIN=40,ESR_MAX_EHIGH_COEFF=256,TRANSFORM_PREEMCOEF_DEF=31785,TRANSFORM_CHANSNUM_DEF=24,TRANSFORM_CEPSNUM_DEF=11,TRANSFORM_STEP_DEF=1,FEATURE_DIMNESION=36,TRANSFROM_CEPLIFTER_DEF=22,TRANSFORM_FFTNUM_DEF=512,TRANSFORM_HALFFFTNUM_DEF=256,ESR_FEATURE_MEMSIZE=2*FEATURE_DIMNESION,ESR_SKIP_FRAME=8,ESR_MATH_LN2=2907270,ESR_MATH_10LN2=29072700,g_s16SimpleLnTable=[0,32,64,96,128,160,191,223,255,287,318,350,382,413,445,477,508,540,571,602,634,665,697,728,759,790,822,853,884,915,946,977,1008,1039,1070,1101,1132,1163,1194,1225,1256,1286,1317,1348,1379,1409,1440,1471,1501,1532,1562,1593,1623,1654,1684,1714,1745,1775,1805,1836,1866,1896,1926,1956,1987,2017,2047,2077,2107,2137,2167,2197,2227,2256,2286,2316,2346,2376,2406,2435,2465,2495,2524,2554,2583,2613,2643,2672,2702,2731,2760,2790,2819,2849,2878,2907,2936,2966,2995,3024,3053,3082,3111,3141,3170,3199,3228,3257,3286,3315,3343,3372,3401,3430,3459,3488,3516,3545,3574,3603,3631,3660,3688,3717,3746,3774,3803,3831,3860,3888,3916,3945,3973,4001,4030,4058,4086,4115,4143,4171,4199,4227,4255,4283,4311,4340,4368,4396,4424,4451,4479,4507,4535,4563,4591,4619,4646,4674,4702,4730,4757,4785,4813,4840,4868,4895,4923,4950,4978,5005,5033,5060,5088,5115,5143,5170,5197,5224,5252,5279,5306,5333,5361,5388,5415,5442,5469,5496,5523,5550,5577,5604,5631,5658,5685,5712,5739,5766,5792,5819,5846,5873,5900,5926,5953,5980,6006,6033,6060,6086,6113,6139,6166,6192,6219,6245,6272,6298,6324,6351,6377,6403,6430,6456,6482,6509,6535,6561,6587,6613,6640,6666,6692,6718,6744,6770,6796,6822,6848,6874,6900,6926,6952,6977,7003,7029,7055,7081,7107,7132,7158,7184,7209,7235,7261,7286,7312,7338,7363,7389,7414,7440,7465,7491,7516,7542,7567,7592,7618,7643,7668,7694,7719,7744,7770,7795,7820,7845,7870,7896,7921,7946,7971,7996,8021,8046,8071,8096,8121,8146,8171,8196,8221,8246,8271,8295,8320,8345,8370,8395,8419,8444,8469,8494,8518,8543,8568,8592,8617,8641,8666,8691,8715,8740,8764,8789,8813,8837,8862,8886,8911,8935,8959,8984,9008,9032,9057,9081,9105,9129,9154,9178,9202,9226,9250,9274,9299,9323,9347,9371,9395,9419,9443,9467,9491,9515,9539,9562,9586,9610,9634,9658,9682,9706,9729,9753,9777,9801,9824,9848,9872,9895,9919,9943,9966,9990,10013,10037,10061,10084,10108,10131,10155,10178,10202,10225,10248,10272,10295,10319,10342,10365,10389,10412,10435,10458,10482,10505,10528,10551,10574,10598,10621,10644,10667,10690,10713,10736,10759,10782,10805,10828,10851,10874,10897,10920,10943,10966,10989,11012,11035,11058,11080,11103,11126,11149,11171,11194,11217,11240,11262,11285,11308,11330,11353,11376,11398,11421,11443,11466,11489,11511,11534,11556,11579,11601,11623,11646,11668,11691,11713,11735,11758,11780,11803,11825,11847,11869,11892,11914,11936,11958,11981,12003,12025,12047,12069,12091,12114,12136,12158,12180,12202,12224,12246,12268,12290,12312,12334,12356,12378,12400,12422,12444,12465,12487,12509,12531,12553,12575,12596,12618,12640,12662,12683,12705,12727,12749,12770,12792,12814,12835,12857,12878,12900,12922,12943,12965,12986,13008,13029,13051,13072,13094,13115,13137,13158,13179,13201,13222,13244,13265,13286,13308,13329,13350,13372,13393,13414,13435,13457,13478,13499,13520,13541,13562,13584,13605,13626,13647,13668,13689,13710,13731,13752,13773,13794,13815,13836,13857,13878,13899,13920,13941,13962,13983,14004,14025,14045,14066,14087,14108,14129,14149,14170,14191,14212,14232,14253,14274,14295,14315,14336,14357,14377,14398,14418,14439,14460,14480,14501,14521,14542,14562,14583,14603,14624,14644,14665,14685,14706,14726,14747,14767,14787,14808,14828,14848,14869,14889,14909,14930,14950,14970,14991,15011,15031,15051,15071,15092,15112,15132,15152,15172,15192,15213,15233,15253,15273,15293,15313,15333,15353,15373,15393,15413,15433,15453,15473,15493,15513,15533,15553,15573,15593,15612,15632,15652,15672,15692,15712,15731,15751,15771,15791,15811,15830,15850,15870,15889,15909,15929,15948,15968,15988,16007,16027,16047,16066,16086,16105,16125,16145,16164,16184,16203,16223,16242,16262,16281,16301,16320,16340,16359,16378,16398,16417,16437,16456,16475,16495,16514,16533,16553,16572,16591,16610,16630,16649,16668,16687,16707,16726,16745,16764,16784,16803,16822,16841,16860,16879,16898,16917,16937,16956,16975,16994,17013,17032,17051,17070,17089,17108,17127,17146,17165,17184,17203,17222,17240,17259,17278,17297,17316,17335,17354,17373,17391,17410,17429,17448,17467,17485,17504,17523,17542,17560,17579,17598,17616,17635,17654,17673,17691,17710,17728,17747,17766,17784,17803,17821,17840,17859,17877,17896,17914,17933,17951,17970,17988,18007,18025,18044,18062,18080,18099,18117,18136,18154,18173,18191,18209,18228,18246,18264,18283,18301,18319,18337,18356,18374,18392,18411,18429,18447,18465,18483,18502,18520,18538,18556,18574,18592,18611,18629,18647,18665,18683,18701,18719,18737,18755,18773,18791,18810,18828,18846,18864,18882,18900,18917,18935,18953,18971,18989,19007,19025,19043,19061,19079,19097,19114,19132,19150,19168,19186,19204,19221,19239,19257,19275,19293,19310,19328,19346,19364,19381,19399,19417,19434,19452,19470,19487,19505,19523,19540,19558,19576,19593,19611,19628,19646,19663,19681,19699,19716,19734,19751,19769,19786,19804,19821,19839,19856,19873,19891,19908,19926,19943,19961,19978,19995,20013,20030,20048,20065,20082,20100,20117,20134,20151,20169,20186,20203,20221,20238,20255,20272,20290,20307,20324,20341,20358,20376,20393,20410,20427,20444,20461,20479,20496,20513,20530,20547,20564,20581,20598,20615,20632,20649,20666,20683,20700,20717,20734,20751,20768,20785,20802,20819,20836,20853,20870,20887,20904,20921,20938,20955,20972,20988,21005,21022,21039,21056,21073,21089,21106,21123,21140,21157,21173,21190,21207,21224,21240,21257,21274,21291,21307,21324,21341,21357,21374,21391,21407,21424,21441,21457,21474,21491,21507,21524,21540,21557,21573,21590,21607,21623,21640,21656,21673,21689,21706,21722,21739,21755,21772,21788,21805,21821,21837,21854,21870,21887,21903,21920,21936,21952,21969,21985,22001,22018,22034,22050,22067,22083,22099,22116,22132,22148,22164,22181,22197,22213,22229,22246,22262,22278,22294,22311,22327,22343,22359,22375,22391,22408,22424,22440,22456,22472,22488,22504,22520,22537,22553,22569,22585,22601,22617,22633,22649,22665,22681,22697],enableVoiceDataCache=!0,outAudioList=new Array,speechStart=!1,speechEnd=!1;function VadState(){return m_iVADState}function Volume(){return m_latestVolume}function SpeechStart(){return speechStart}function SpeechEnd(){return speechEnd}function Vad(){log("vad init"),m_pPCMBuffer=new Array,m_pPCMFrame=new Array,m_pFrameEnergy=new Array,m_ppPCM=new Array,Reset()}function Reset(){m_s32ESil=m_iSpeechBegin=m_iFrameHead=m_iFrameEnd=0,m_iVADState=ESVadStatus.ESVAD_SILENCE,m_iFrameCurrent=parseInt(ESR_SKIP_FRAME),m_iPCMStart=m_iPCMEnd=m_iSpeechEnd=0}function BlockCopy(_,E,e,a,m){for(var S=0;S<m;)m_ppPCM[a+S]=_[E+S],S++}function AppendData(_,E){var e,a;if(log("call AppendData function, pcmDataLength : "+E+", pcmData[0] : "+_[0]),1==E){var m=m_iPCMEnd;return m_pPCMBuffer[m]=_[0],ESR_PCMBUFFER_SIZE<=++m&&(m-=ESR_PCMBUFFER_SIZE),m==m_iPCMStart?7:(m_iPCMEnd=m,0)}if((e=parseInt(m_iPCMEnd-m_iPCMStart))<0&&(e+=ESR_PCMBUFFER_SIZE),ESR_PCMBUFFER_SIZE-1<(e+=E))return 7;if(m_iPCMEnd+E<ESR_PCMBUFFER_SIZE){for(a=0;a<E;a++)m_pPCMBuffer[m_iPCMEnd+a]=_[a];m_iPCMEnd+=E}else{var S;for(S=ESR_PCMBUFFER_SIZE-m_iPCMEnd,a=0;a<S;a++)m_pPCMBuffer[m_iPCMEnd+a]=_[a];for(a=0;a<E-S;a++)m_pPCMBuffer[a]=_[S+a];m_iPCMEnd=E-S}for(log("call AppendData function, m_iPCMEnd : "+m_iPCMEnd);;){var r=!1;if(ESVadStatus.ESVAD_INACTIVE!=m_iVADState&&(r=GetOneFrame())){if(m_pFrameEnergy[m_iFrameEnd%ESR_FRAME_MAXNUM]=CalcFrameEnergy(),BlockCopy(m_pPCMFrame,0,m_ppPCM,m_iFrameEnd%parseInt(ESR_FRAME_MAXNUM)*parseInt(ESR_FRAME_STEP)*2,2*parseInt(ESR_FRAME_STEP)),++m_iFrameEnd<parseInt(ESIL_CHKBG_FRAMENUM))continue;CheckVoice()}if(m_iFrameCurrent<m_iSpeechEnd){if(enableVoiceDataCache){var t=new Array;BlockCopy(m_ppPCM,m_iFrameCurrent%parseInt(ESR_FRAME_MAXNUM)*parseInt(ESR_FRAME_STEP)*2,t,0,parseInt(2*ESR_FRAME_STEP)),outAudioList[outAudioList.length]=t}m_iFrameCurrent++}if(ESVadStatus.ESVAD_INACTIVE==m_iVADState&&m_iFrameCurrent<m_iSpeechEnd){if(enableVoiceDataCache){t=new Array;BlockCopy(m_ppPCM,m_iFrameCurrent%parseInt(ESR_FRAME_MAXNUM)*parseInt(ESR_FRAME_STEP)*2,t,0,parseInt(2*ESR_FRAME_STEP)),outAudioList[outAudioList.length]=t}m_iFrameCurrent++}if(!r)break}var i=m_latestVolume=0;for(a=0;a<E;a++){var n;i+=(n=_[a]>>2)*n+8>>4}return(i/=E)<256?m_latestVolume=0:9<(m_latestVolume=simple_table_ln(i,6)>>22)&&(m_latestVolume=9),log("vad volume : "+m_latestVolume),postMessage({command:"volume",message:m_latestVolume}),0}function GetVoiceData(){var _=null;return 0<outAudioList.Count&&(_=outAudioList[0],outAudioList.splice(0,1)),_}function GetVoiceDataSamples(){return outAudioList.Count*parseInt(ESR_FRAME_STEP)}function simple_table_ln(_,E){var e,a=E;return 0==(4294901760&++_)&&(_<<=16,a+=16),0==(4278190080&_)&&(_<<=8,a+=8),0==(4026531840&_)&&(_<<=4,a+=4),0==(3221225472&_)&&(_<<=2,a+=2),0==(2147483648&_)&&(_<<=1,a+=1),e=g_s16SimpleLnTable[(_-=2147483648)>>21]<<7,e+=(31-a)*parseInt(ESR_MATH_LN2)}function CalcFrameEnergy(){var _,E,e=0;for(_=0;_<ESR_FRAME_SIZE;_++)e+=m_pPCMFrame[_];for(e/=parseInt(ESR_FRAME_SIZE),_=E=0;_<ESR_FRAME_SIZE;_++){var a;E+=(a=m_pPCMFrame[_]-e)*a+128>>8}return E>>=2,Math.max(40,E)}function GetOneFrame(){var _=parseInt(m_iPCMEnd-m_iPCMStart);if(_<0&&(_+=parseInt(ESR_PCMBUFFER_SIZE)),_<ESR_FRAME_SIZE)return!1;if(m_iPCMStart+ESR_FRAME_SIZE<=ESR_PCMBUFFER_SIZE){for(var E=0;E<ESR_FRAME_SIZE;E++)m_pPCMFrame[E]=m_pPCMBuffer[m_iPCMStart+E];m_iPCMStart+=ESR_FRAME_STEP}else{var e=ESR_PCMBUFFER_SIZE-m_iPCMStart;for(E=0;E<e;E++)m_pPCMFrame[E]=m_pPCMBuffer[m_iPCMStart+E];for(E=0;E<ESR_FRAME_SIZE-e;E++)m_pPCMFrame[e+E]=m_pPCMBuffer[E];ESR_PCMBUFFER_SIZE<(m_iPCMStart+=ESR_FRAME_STEP)&&(m_iPCMStart-=ESR_PCMBUFFER_SIZE)}return!0}function CheckEngery(_,E,e){for(var a=0,m=0;a<e;a++)if(m_pFrameEnergy[(m_iFrameCheck+a)%ESR_FRAME_MAXNUM]>_?m++:m=0,E<m)return m_iFrameCheck=a+m_iFrameCheck-E,!0;return!1}function CheckVoice(){var _,E,e,a,m;for(_=m_iFrameEnd-m_iFrameHead;0!=_;){if(0==(_=m_iFrameEnd-m_iFrameHead))return;if(0==m_s32ESil){if(_<ESIL_CHKBG_FRAMENUM)return;if(m_iFrameHead<=ESR_FRAME_SIZE/ESR_FRAME_STEP){++m_iFrameHead;continue}for(m_nCheckEndFrame=parseInt(EHIGH_CHKEND_FRAMENUM_SHORT),E=m_s32ESil=0;E<ESIL_CHKBG_FRAMENUM;E++)m_s32ESil+=m_pFrameEnergy[(m_iFrameHead+E)%ESR_FRAME_MAXNUM];m_s32ESil/=parseInt(ESIL_CHKBG_FRAMENUM),m_iFrameCheck=m_iFrameHead+1,a=m_s32ESil+200,m_s32ELow=parseInt(20*a/((simple_table_ln(a,0)+ESR_MATH_10LN2>>18)-64)),m_s32ELow<<=5,m_s32ELow-=200}switch(log("check vad state : "+m_iVADState),m_iVADState){case ESVadStatus.ESVAD_SILENCE:if(parseInt(m_iFrameEnd-m_iFrameCheck)<ELOW_CHKBG_FRAMENUM)return;if(CheckEngery(m_s32ELow,parseInt(ELOW_VALIDREQ_THRESH),parseInt(ELOW_CHKBG_FRAMENUM))){for(E=m_iFrameHead+1;E<=m_iFrameCheck-ESIL_CHKBG_FRAMENUM;++E){for(e=a=0;e<ESIL_CHKBG_FRAMENUM;e++)a+=m_pFrameEnergy[(E+e)%ESR_FRAME_MAXNUM];(a/=parseInt(ESIL_CHKBG_FRAMENUM))<m_s32ESil&&(m_s32ESil=a,m_iFrameHead=E)}m=((a=parseInt(simple_table_ln(m_s32ESil,0)+ESR_MATH_10LN2>>14))-2304)*(a-2304)>>12,m_s32EHigh=360*m_s32ESil/(m+=512)<<5,m_iSpeechBegin=m_iFrameCheck,m_iVADState=ESVadStatus.ESVAD_CHECK_BEGIN,speechStart=!0}else m_s32ESil=0,m_iVADState=ESVadStatus.ESVAD_SILENCE,m_iFrameHead++;break;case ESVadStatus.ESVAD_CHECK_BEGIN:if(parseInt(m_iFrameEnd-m_iFrameCheck)<EHIGH_CHKBG_FRAMENUM)return;if(CheckEngery(m_s32EHigh,parseInt(EHIGH_VALIDREQ_THRESH),parseInt(EHIGH_CHKBG_FRAMENUM)))m_iFrameCheck=(m_iFrameHead=m_iSpeechBegin)+1,m_iFrameCurrent=Math.max(m_iSpeechBegin-parseInt(SPEECH_BEGIN_MARGIN),parseInt(ESR_SKIP_FRAME)),m_iVADState=ESVadStatus.ESVAD_ACTIVE,m_iSpeechEnd=Math.min(m_iSpeechBegin+parseInt(SPEECH_END_MARGIN),m_iFrameEnd),m_iSpeechEnd2=m_iSpeechBegin,Math.max(m_iSpeechBegin,parseInt(ESR_SKIP_FRAME)),m_s32EMax=0;else m_s32ESil=0,m_iVADState=ESVadStatus.ESVAD_SILENCE,m_iFrameHead++;break;case ESVadStatus.ESVAD_ACTIVE:(a=m_pFrameEnergy[m_iFrameHead%ESR_FRAME_MAXNUM])<m_s32ELow?(m_iVADState=ESVadStatus.ESVAD_CHECK_END,m_iFrameCheck=m_iFrameHead+1):(m_s32EMax=Math.max(m_s32EMax,a),m_s32EHigh*ESR_MAX_EHIGH_COEFF<m_s32EMax&&(a=simple_table_ln(m_s32EMax/ESR_MAX_EHIGH_COEFF,-10)>>14,a=(a-=2304)*a>>12,a+=512,a=simple_table_ln(a=m_s32EMax/(16*parseInt(ESR_MAX_EHIGH_COEFF))*a/720,-10)>>14,a=(a-=2304)*a>>12,a+=512,a=m_s32EMax/(16*parseInt(ESR_MAX_EHIGH_COEFF))*a/720,m_s32ELow=20*(a=(m_s32ESil=a)+200)/parseInt((simple_table_ln(a,0)+ESR_MATH_10LN2>>18)-64),m_s32ELow<<=5,m_s32ELow-=200,m=((a=parseInt(simple_table_ln(m_s32ESil,0)+ESR_MATH_10LN2>>14))-2304)*(a-2304)>>12,m_s32EHigh=360*m_s32ESil/(m+=512)<<5),m_iFrameHead++),m_iSpeechEnd=Math.min(m_iFrameHead+parseInt(SPEECH_END_MARGIN),m_iFrameEnd),m_iSpeechEnd2=m_iFrameHead;break;case ESVadStatus.ESVAD_CHECK_END:if(m_iSpeechEnd=Math.min(m_iFrameHead+parseInt(SPEECH_END_MARGIN),m_iFrameEnd),m_iSpeechEnd2=m_iFrameHead,m_iFrameEnd-m_iFrameCheck<m_nCheckEndFrame)return;if(!CheckEngery(m_s32EHigh,parseInt(EHIGH_ENDVALID_THRESH),m_nCheckEndFrame))return m_iVADState=ESVadStatus.ESVAD_INACTIVE,speechEnd=!0,log("local vad check end!!!!"),postMessage({command:"esvad",message:"end"}),m_iFrameCheck=m_iFrameHead+1,m_s32ESil=0,void(m_iSpeechEnd-m_iSpeechBegin<MINIMUM_SPEECH_FRAMENUM+SPEECH_END_MARGIN&&(m_iSpeechEnd=m_iSpeechBegin=0,m_iVADState=ESVadStatus.ESVAD_SILENCE));log("local vad check end!!!!"+CheckEngery(m_s32EHigh,parseInt(EHIGH_ENDVALID_THRESH),m_nCheckEndFrame)),m_iFrameHead++,m_iVADState=ESVadStatus.ESVAD_ACTIVE,m_nCheckEndFrame=parseInt(EHIGH_CHKEND_FRAMENUM_SHORT);break;case ESVadStatus.ESVAD_INACTIVE:return}}}'], {
                    type: "text/javascript"
                })),
                m.speexWorkerPath = u.URL.createObjectURL(new Blob(['function log(e){postMessage({type:"debug",message:e})}var encoder,bits,rawData;onmessage=function(e){switch(e.data.command){case"init":SpeexEncoder(BandMode.Wide),encoder.Quality=5;break;case"encode":Encode(e.data.inData,e.data.inOffset,e.data.inCount,[],e.data.outOffset,e.data.outCount)}};var speexWbFrameLen=[10,15,20,25,32,42,52,60,70,86,106],speex_quality=5;function SpeexEncoder(e){switch(bits=new Bits,e){case BandMode.Narrow:encoder=new NbEncoder;break;case BandMode.Wide:encoder=new SbEncoder(!1);break;case BandMode.UltraWide:encoder=new SbEncoder(!0)}FrameSize=320,rawData=new Array}function Encode(e,r,o,a,n,t){for(var i=o/FrameSize,f=[],s=0;s<i;s++){bits.Reset();for(var _=0;_<o;){for(var c=0;c<FrameSize;c++)rawData[c]=e[r+c+_];encoder.Encode(bits,rawData),_+=FrameSize}bits.Write(a,n,t),f[s*(speexWbFrameLen[speex_quality]+1)]=speexWbFrameLen[speex_quality],ArrayCopy(a,0,f,s*(speexWbFrameLen[speex_quality]+1)+1,speexWbFrameLen[speex_quality])}postMessage({command:"encode",buffer:f})}function Inner_prod(e,r,o,a,n){var t,i=0,f=0,s=0,_=0;for(t=0;t<n;)i+=e[r+t]*o[a+t],f+=e[r+t+1]*o[a+t+1],s+=e[r+t+2]*o[a+t+2],_+=e[r+t+3]*o[a+t+3],t+=4;return i+f+s+_}function Open_loop_nbest_pitch(e,r,o,a,n,t,i,f){var s,_,c,p,u,l,m,b;for(p=new Array,l=new Array,m=new Array,b=new Array,s=0;s<f;s++)p[s]=-1,i[s]=0,t[s]=o;for(m[0]=Inner_prod(e,r-o,e,r-o,n),u=Inner_prod(e,r,e,r,n),s=o;s<=a;s++)m[s-o+1]=m[s-o]+e[r-s-1]*e[r-s-1]-e[r-s+n-1]*e[r-s+n-1],m[s-o+1]<1&&(m[s-o+1]=1);for(s=o;s<=a;s++)l[s-o]=0,b[s-o]=0;for(s=o;s<=a;s++)l[s-o]=Inner_prod(e,r,e,r-s,n),b[s-o]=l[s-o]*l[s-o]/(m[s-o]+1);for(s=o;s<=a;s++){var d,S;if(b[s-o]>p[f-1])for((d=l[s-o]/(m[s-o]+10))<(S=Math.sqrt(d*l[s-o]/(u+10)))&&(S=d),S<0&&(S=0),_=0;_<f;_++)if(b[s-o]>p[_]){for(c=f-1;_<c;c--)p[c]=p[c-1],t[c]=t[c-1],i[c]=i[c-1];p[_]=b[s-o],t[_]=s,i[_]=S;break}}}function CreateJaggedArray(e,r){for(var o=new Array,a=0;a<e;a++)o[a]=[];return o}var Ltp3Tap=function(e,r,o){var I=new Array;I[0]=I[1]=I[1]=0;var M=e,F=r,q=o,E=CreateJaggedArray(3,128);function Q(e,r,o,a,n,t,i,f,s,_,c,p,u,l){var m,b,d,S,w,h=new Array,y=CreateJaggedArray(3,3);for(S=1<<F,d=CreateJaggedArray(3,s),E=CreateJaggedArray(3,s),m=2;0<=m;m--){var z=i+1-m;for(b=0;b<s;b++)E[m][b]=b-z<0?c[p+b-z]:b-z-i<0?c[p+b-z-i]:0;if(2==m)Filters.Syn_percep_zero(E[m],0,r,o,a,d[m],s,f);else{for(b=0;b<s-1;b++)d[m][b+1]=d[m+1][b];for(b=d[m][0]=0;b<s;b++)d[m][b]+=E[m][0]*u[b]}}for(m=0;m<3;m++)h[m]=Inner_prod(d[m],0,e,0,s);for(m=0;m<3;m++)for(b=0;b<=m;b++)y[m][b]=y[b][m]=Inner_prod(d[m],0,d[b],0,s);var v=new Array,C=0,x=0,A=0;for(v[0]=h[2],v[1]=h[1],v[2]=h[0],v[3]=y[1][2],v[4]=y[0][1],v[5]=y[0][2],v[6]=y[2][2],v[7]=y[1][1],v[8]=y[0][0],m=0;m<S;m++){var k,B,g,L=0;k=.015625*M[C=3*m]+.5,B=.015625*M[C+1]+.5,g=.015625*M[C+2]+.5,L+=v[0]*k,L+=v[1]*B,L+=v[2]*g,L-=v[3]*k*B,L-=v[4]*g*B,L-=v[5]*g*k,L-=.5*v[6]*k*k,L-=.5*v[7]*B*B,(A<(L-=.5*v[8]*g*g)||0==m)&&(A=L,x=m)}for(I[0]=.015625*M[3*x]+.5,I[1]=.015625*M[3*x+1]+.5,I[2]=.015625*M[3*x+2]+.5,l[0]=x,m=0;m<s;m++)n[t+m]=I[0]*E[2][m]+I[1]*E[1][m]+I[2]*E[0][m];for(m=w=0;m<s;m++)e[m]*e[m];for(m=0;m<s;m++)w+=(e[m]-I[2]*d[0][m]-I[1]*d[1][m]-I[0]*d[2][m])*(e[m]-I[2]*d[0][m]-I[1]*d[1][m]-I[0]*d[2][m]);return w}this.Quant=function(e,r,o,a,n,t,i,f,s,_,c,p,u,l,m,b,d,S){for(var w,h=new Array,y=h[0]=0,z=0,v=new Array,C=0;C<u;C++)v[C]=0;var x,A,k=0,B=-1,g=new Array,L=new Array;10<(A=S)&&(A=10);for(C=0;C<A;C++)g[C]=0,L[C]=0;if(0==A||_<s){for(l.Pack(0,q),l.Pack(0,F),C=0;C<u;C++)i[f+C]=0;return s}for(_-s+1<A&&(A=_-s+1),Open_loop_nbest_pitch(r,o,s,_,u,g,L,A),C=0;C<A;C++){for(y=g[C],w=0;w<u;w++)i[f+w]=0;if((x=Q(e,a,n,t,i,f,y,p,u,l,m,b,d,h))<B||B<0){for(w=0;w<u;w++)v[w]=i[f+w];B=x,k=y,z=h[0]}}for(l.Pack(k-s,q),l.Pack(z,F),C=0;C<u;C++)i[f+C]=v[C];return y}},LtpForcedPitch=function(){},Filters=function(){},last_pitch=0,last_pitch_gain=new Array;last_pitch_gain[0]=last_pitch_gain[1]=last_pitch_gain[2]=0;for(var smooth_gain=1,xx=new Array,i=0;i<1024;i++)xx[i]=0;function NoiseSearch(){}Filters.prototype.Residue_percep_zero=Filters.Residue_percep_zero=function(e,r,o,a,n,t,i,f){for(var s,_=new Array,c=0;c<f;c++)_[c]=0;for(Filters.Filter_mem2_b(e,r,o,a,t,0,i,f,_,0),s=0;s<f;s++)_[s]=0;Filters.Fir_mem2(t,0,n,t,0,i,f,_)},Filters.prototype.Fir_mem_up=Filters.Fir_mem_up=function(e,r,o,a,n,t){var i,f;for(i=0;i<a/2;i++)xx[2*i]=e[a/2-1-i];for(i=0;i<n-1;i+=2)xx[a+i]=t[i+1];for(i=0;i<a;i+=4){var s,_,c,p,u;for(s=_=c=p=0,u=xx[a-4-i],f=0;f<n;f+=4){var l,m,b;m=r[f],b=r[f+1],s+=m*(l=xx[a-2+f-i]),_+=b*l,c+=m*u,p+=b*u,m=r[f+2],b=r[f+3],s+=m*(u=xx[a+f-i]),_+=b*u,c+=m*l,p+=b*l}o[i]=s,o[i+1]=_,o[i+2]=c,o[i+3]=p}for(i=0;i<n-1;i+=2)t[i+1]=xx[i]},Filters.prototype.Syn_percep_zero=Filters.Syn_percep_zero=function(e,r,o,a,n,t,i,f){for(var s,_=new Array,c=0;c<f;c++)_[c]=0;for(Filters.Filter_mem2_b(e,r,a,o,t,0,i,f,_,0),s=0;s<f;s++)_[s]=0;Filters.Iir_mem2(t,0,n,t,0,i,f,_)},Filters.prototype.Qmf_decomp=Filters.Qmf_decomp=function(e,r,o,a,n,t,i){var f,s,_,c,p,u,l;for(p=new Array,u=new Array,l=t-1,c=t>>1,f=0;f<t;f++)p[t-f-1]=r[f];for(f=0;f<t-1;f++)u[f]=i[t-f-2];for(f=0;f<n;f++)u[f+t-1]=e[f];for(_=f=0;f<n;f+=2,_++)for(o[_]=0,s=a[_]=0;s<c;s++)o[_]+=p[s]*(u[f+s]+u[l+f-s]),a[_]-=p[s]*(u[f+s]-u[l+f-s]),s++,o[_]+=p[s]*(u[f+s]+u[l+f-s]),a[_]+=p[s]*(u[f+s]-u[l+f-s]);for(f=0;f<t-1;f++)i[f]=e[n-f-1]},Filters.prototype.Iir_mem2=Filters.Iir_mem2=function(e,r,o,a,n,t,i,f){var s,_;for(s=0;s<t;s++){for(a[n+s]=e[r+s]+f[0],_=0;_<i-1;_++)f[_]=f[_+1]-o[_+1]*a[n+s];f[i-1]=-o[i]*a[n+s]}},Filters.prototype.Fir_mem2=Filters.Fir_mem2=function(e,r,o,a,n,t,i,f){var s,_,c;for(s=0;s<t;s++){for(c=e[r+s],a[n+s]=o[0]*c+f[0],_=0;_<i-1;_++)f[_]=f[_+1]+o[_+1]*c;f[i-1]=o[i]*c}},Filters.prototype.Filter_mem2_b=Filters.Filter_mem2_b=function(e,r,o,a,n,t,i,f,s,_){var c,p,u,l;for(c=0;c<i;c++){for(u=e[r+c],n[t+c]=o[0]*u+s[0],l=n[t+c],p=0;p<f-1;p++)s[_+p]=s[_+p+1]+o[p+1]*u-a[p+1]*l;s[_+f-1]=o[f]*u-a[f]*l}},Filters.prototype.Bw_lpc=Filters.Bw_lpc=function(e,r,o,a){for(var n=1,t=0;t<a+1;t++)o[t]=n*r[t],n*=e};var VQ=function(){};function SplitShapeSearch(e,r,o,a,n,t){for(var P=r,N=o,W=a,O=1<<n,R=n,H=t,Z=new Array,i=new Array,f=0;f<o;f++)Z[f]=0,i[f]=0;var G=[],K=[],V=[],U=[];for(f=0;f<10;f++)G[f]=[],K[f]=[],V[f]=[],U[f]=[];new Array;var T=new Array,J=new Array,X=new Array;this.Quantify=function(e,r,o,a,n,t,i,f,s,_,c){var p,u,l,m,b,d,S,w,h,y,z,v,C=c;10<C&&(C=10),d=new Array,h=new Array,y=new Array,S=new Array,w=new Array,z=new Array,v=new Array;for(var x=0;x<C;x++)h[x]=0,z[x]=0,v[x]=0;for(x=0;x<C;x++)for(p=0;p<N;p++)U[x][p]=V[x][p]=-1;for(p=0;p<C;p++)for(x=0;x<t;x++)G[p][x]=e[x];for(x=0;x<O;x++){var A,k;for(k=A=x*P,p=0;p<P;p++)for(u=d[A+p]=0;u<=p;u++)d[A+p]+=.03125*W[k+u]*s[p-u];for(p=X[x]=0;p<P;p++)X[x]+=d[A+p]*d[A+p]}for(p=0;p<C;p++)w[p]=0;for(x=0;x<N;x++){var B,g=x*P;for(p=0;p<C;p++)S[p]=2147483647;for(p=0;p<C;p++)z[p]=v[p]=0;for(p=0;p<C;p++){var L=0;for(l=g;l<g+P;l++)L+=G[p][l]*G[p][l];for(L*=.5,0!=H?VQ.Nbest_sign(G[p],g,d,P,O,X,C,h,y):VQ.Nbest(G[p],g,d,P,O,X,C,h,y),u=0;u<C;u++){var I=w[p]+y[u]+L;if(I<S[C-1])for(l=0;l<C;l++)if(I<S[l]){for(m=C-1;l<m;m--)S[m]=S[m-1],z[m]=z[m-1],v[m]=v[m-1];S[l]=I,z[m]=h[u],v[m]=p;break}}if(0==x)break}for(p=0;p<C;p++){for(l=(x+1)*P;l<t;l++)K[p][l]=G[v[p]][l];for(l=0;l<P;l++){var M,F,q,E=1;for(F=z[p],O<=F&&(E=-1,F-=O),b=P-l,M=.03125*E*W[F*P+l],m=0,q=g+P;m<t-P*(x+1);m++,q++)K[p][q]-=M*s[m+b]}for(b=0;b<N;b++)U[p][b]=V[v[p]][b];U[p][x]=z[p]}for(B=G,G=K,K=B,p=0;p<C;p++)for(l=0;l<N;l++)V[p][l]=U[p][l];for(p=0;p<C;p++)w[p]=S[p]}for(x=0;x<N;x++)Z[x]=U[0][x],_.Pack(Z[x],R+H);for(x=0;x<N;x++){var Q,D=1;for(Q=Z[x],O<=Q&&(D=-1,Q-=O),p=0;p<P;p++)T[P*x+p]=.03125*D*W[Q*P+p]}for(p=0;p<t;p++)i[f+p]+=T[p];for(Filters.Syn_percep_zero(T,0,r,o,a,J,t,n),p=0;p<t;p++)e[p]-=J[p]}}function LspQuant(){}VQ.prototype.Index_s=VQ.Index_s=function(e,r,o){var a,n=0,t=0;for(a=0;a<o;a++){var i=e-r[a];i*=i,(0==a||i<n)&&(n=i,t=a)}return t},VQ.prototype.Nbest=VQ.Nbest=function(e,r,o,a,n,t,i,f,s){var _,c,p,u=0,l=0;for(_=0;_<n;_++){var m=.5*t[_];for(c=0;c<a;c++)m-=e[r+c]*o[u++];if(_<i||m<s[i-1]){for(p=i-1;1<=p&&(l<p||m<s[p-1]);p--)s[p]=s[p-1],f[p]=f[p-1];s[p]=m,f[p]=_,l++}}},LspQuant.MAX_LSP_SIZE=20,LspQuant.prototype.Lsp_quant=LspQuant.Lsp_quant=function(e,r,o,a,n){var t,i,f,s,_=0,c=0,p=0;for(t=0;t<a;t++){for(i=f=0;i<n;i++)f+=(s=e[r+i]-o[p++])*s;(f<_||0==t)&&(_=f,c=t)}for(i=0;i<n;i++)e[r+i]-=o[c*n+i];return c},LspQuant.prototype.Lsp_weight_quant=LspQuant.Lsp_weight_quant=function(e,r,o,a,n,t,i){var f,s,_,c,p=0,u=0,l=0;for(f=0;f<t;f++){for(s=_=0;s<i;s++)c=e[r+s]-n[l++],_+=o[a+s]*c*c;(_<p||0==f)&&(p=_,u=f)}for(s=0;s<i;s++)e[r+s]-=n[u*i+s];return u};var Codebook_Constants=new function(){};Codebook_Constants.exc_20_32_table=[12,32,25,46,36,33,9,14,-3,6,1,-8,0,-10,-5,-7,-7,-7,-5,-5,31,-27,24,-32,-4,10,-11,21,-3,19,23,-9,22,24,-10,-1,-10,-13,-7,-11,42,-33,31,19,-8,0,-10,-16,1,-21,-17,10,-8,14,8,4,11,-2,5,-2,-33,11,-16,33,11,-4,9,-4,11,2,6,-5,8,-5,11,-4,-6,26,-36,-16,0,4,-2,-8,12,6,-1,34,-46,-22,9,9,21,9,5,-66,-5,26,2,10,13,2,19,9,12,-81,3,13,13,0,-14,22,-35,6,-7,-4,6,-6,10,-6,-31,38,-33,0,-10,-11,5,-12,12,-17,5,0,-6,13,-9,10,8,25,33,2,-12,8,-6,10,-2,21,7,17,43,5,11,-7,-9,-20,-36,-20,-23,-4,-4,-3,27,-9,-9,-49,-39,-38,-11,-9,6,5,23,25,5,3,3,4,1,2,-3,-1,87,39,17,-21,-9,-19,-9,-15,-13,-14,-17,-11,-10,-11,-8,-6,-1,-3,-3,-1,-54,-34,-27,-8,-11,-4,-5,0,0,4,8,6,9,7,9,7,6,5,5,5,48,10,19,-10,12,-1,9,-3,2,5,-3,2,-2,-2,0,-2,-26,6,9,-7,-16,-9,2,7,7,-5,-43,11,22,-11,-9,34,37,-15,-13,-6,1,-1,1,1,-64,56,52,-11,-27,5,4,3,1,2,1,3,-1,-4,-4,-10,-7,-4,-4,2,-1,-7,-7,-12,-10,-15,-9,-5,-5,-11,-16,-13,6,16,4,-13,-16,-10,-4,2,-47,-13,25,47,19,-14,-20,-8,-17,0,-3,-13,1,6,-17,-14,15,1,10,6,-24,0,-10,19,-69,-8,14,49,17,-5,33,-29,3,-4,0,2,-8,5,-6,2,120,-56,-12,-47,23,-9,6,-5,1,2,-5,1,-10,4,-1,-1,4,-1,0,-3,30,-52,-67,30,22,11,-1,-4,3,0,7,2,0,1,-10,-4,-8,-13,5,1,1,-1,5,13,-9,-3,-10,-62,22,48,-4,-6,2,3,5,1,1,4,1,13,3,-20,10,-9,13,-2,-4,9,-20,44,-1,20,-32,-67,19,0,28,11,8,2,-11,15,-19,-53,31,2,34,10,6,-4,-58,8,10,13,14,1,12,2,0,0,-128,37,-8,44,-9,26,-3,18,2,6,11,-1,9,1,5,3,0,1,1,2,12,3,-2,-3,7,25,9,18,-6,-37,3,-8,-16,3,-10,-7,17,-34,-44,11,17,-15,-3,-16,-1,-13,11,-46,-65,-2,8,13,2,4,4,5,15,5,9,6,8,2,8,3,10,-1,3,-3,6,-2,3,3,-5,10,-11,7,6,-2,6,-2,-9,19,-12,12,-28,38,29,-1,12,2,5,23,-10,3,4,-15,21,-4,3,3,6,17,-9,-4,-8,-20,26,5,-10,6,1,-19,18,-15,-12,47,-6,-2,-7,-9,-1,-17,-2,-2,-14,30,-14,2,-7,-4,-1,-12,11,-25,16,-3,-12,11,-7,7,-17,1,19,-28,31,-7,-10,7,-10,3,12,5,-16,6,24,41,-29,-54,0,1,7,-1,5,-6,13,10,-4,-8,8,-9,-27,-53,-38,-1,10,19,17,16,12,12,0,3,-7,-4,13,12,-31,-14,6,-5,3,5,17,43,50,25,10,1,-6,-2],Codebook_Constants.exc_10_16_table=[22,39,14,44,11,35,-2,23,-4,6,46,-28,13,-27,-23,12,4,20,-5,9,37,-18,-23,23,0,9,-6,-20,4,-1,-17,-5,-4,17,0,1,9,-2,1,2,2,-12,8,-25,39,15,9,16,-55,-11,9,11,5,10,-2,-60,8,13,-6,11,-16,27,-47,-12,11,1,16,-7,9,-3,-29,9,-14,25,-19,34,36,12,40,-10,-3,-24,-14,-37,-21,-35,-2,-36,3,-6,67,28,6,-17,-3,-12,-16,-15,-17,-7,-59,-36,-13,1,7,1,2,10,2,11,13,10,8,-2,7,3,5,4,2,2,-3,-8,4,-5,6,7,-42,15,35,-2,-46,38,28,-20,-9,1,7,-3,0,-2,-5,-4,-2,-4,-8,-3,-8,-5,-7,-4,-15,-28,52,32,5,-5,-17,-20,-10,-1],Codebook_Constants.exc_10_32_table=[7,17,17,27,25,22,12,4,-3,0,28,-36,39,-24,-15,3,-9,15,-5,10,31,-28,11,31,-21,9,-11,-11,-2,-7,-25,14,-22,31,4,-14,19,-12,14,-5,4,-7,4,-5,9,0,-2,42,-47,-16,1,8,0,9,23,-57,0,28,-11,6,-31,55,-45,3,-5,4,2,-2,4,-7,-3,6,-2,7,-3,12,5,8,54,-10,8,-7,-8,-24,-25,-27,-14,-5,8,5,44,23,5,-9,-11,-11,-13,-9,-12,-8,-29,-8,-22,6,-15,3,-12,-1,-5,-3,34,-1,29,-16,17,-4,12,2,1,4,-2,-4,2,-1,11,-3,-52,28,30,-9,-32,25,44,-20,-24,4,6,-1,0,0,-3,7,-4,-4,-7,-6,-9,-2,-10,-7,-25,-10,22,29,13,-13,-22,-13,-4,0,-4,-16,10,15,-36,-24,28,25,-1,-3,66,-33,-11,-15,6,0,3,4,-2,5,24,-20,-47,29,19,-2,-4,-1,0,-1,-2,3,1,8,-11,5,5,-57,28,28,0,-16,4,-4,12,-6,-1,2,-20,61,-9,24,-22,-42,29,6,17,8,4,2,-65,15,8,10,5,6,5,3,2,-2,-3,5,-9,4,-5,23,13,23,-3,-63,3,-5,-4,-6,0,-3,23,-36,-46,9,5,5,8,4,9,-5,1,-3,10,1,-6,10,-11,24,-47,31,22,-12,14,-10,6,11,-7,-7,7,-31,51,-12,-6,7,6,-17,9,-11,-20,52,-19,3,-6,-6,-8,-5,23,-41,37,1,-21,10,-14,8,7,5,-15,-15,23,39,-26,-33,7,2,-32,-30,-21,-8,4,12,17,15,14,11],Codebook_Constants.exc_5_256_table=[-8,-37,5,-43,5,73,61,39,12,-3,-61,-32,2,42,30,-3,17,-27,9,34,20,-1,-5,2,23,-7,-46,26,53,-47,20,-2,-33,-89,-51,-64,27,11,15,-34,-5,-56,25,-9,-1,-29,1,40,67,-23,-16,16,33,19,7,14,85,22,-10,-10,-12,-7,-1,52,89,29,11,-20,-37,-46,-15,17,-24,-28,24,2,1,0,23,-101,23,14,-1,-23,-18,9,5,-13,38,1,-28,-28,4,27,51,-26,34,-40,35,47,54,38,-54,-26,-6,42,-25,13,-30,-36,18,41,-4,-33,23,-32,-7,-4,51,-3,17,-52,56,-47,36,-2,-21,36,10,8,-33,31,19,9,-5,-40,10,-9,-21,19,18,-78,-18,-5,0,-26,-36,-47,-51,-44,18,40,27,-2,29,49,-26,2,32,-54,30,-73,54,3,-5,36,22,53,10,-1,-84,-53,-29,-5,3,-44,53,-51,4,22,71,-35,-1,33,-5,-27,-7,36,17,-23,-39,16,-9,-55,-15,-20,39,-35,6,-39,-14,18,48,-64,-17,-15,9,39,81,37,-68,37,47,-21,-6,-104,13,6,9,-2,35,8,-23,18,42,45,21,33,-5,-49,9,-6,-43,-56,39,2,-16,-25,87,1,-3,-9,17,-25,-11,-9,-1,10,2,-14,-14,4,-1,-10,28,-23,40,-32,26,-9,26,4,-27,-23,3,42,-60,1,49,-3,27,10,-52,-40,-2,18,45,-23,17,-44,3,-3,17,-46,52,-40,-47,25,75,31,-49,53,30,-30,-32,-36,38,-6,-15,-16,54,-27,-48,3,38,-29,-32,-22,-14,-4,-23,-13,32,-39,9,8,-45,-13,34,-16,49,40,32,31,28,23,23,32,47,59,-68,8,62,44,25,-14,-24,-65,-16,36,67,-25,-38,-21,4,-33,-2,42,5,-63,40,11,26,-42,-23,-61,79,-31,23,-20,10,-32,53,-25,-36,10,-26,-5,3,0,-71,5,-10,-37,1,-24,21,-54,-17,1,-29,-25,-15,-27,32,68,45,-16,-37,-18,-5,1,0,-77,71,-6,3,-20,71,-67,29,-35,10,-30,19,4,16,17,5,0,-14,19,2,28,26,59,3,2,24,39,55,-50,-45,-18,-17,33,-35,14,-1,1,8,87,-35,-29,0,-27,13,-7,23,-13,37,-40,50,-35,14,19,-7,-14,49,54,-5,22,-2,-29,-8,-27,38,13,27,48,12,-41,-21,-15,28,7,-16,-24,-19,-20,11,-20,9,2,13,23,-20,11,27,-27,71,-69,8,2,-6,22,12,16,16,9,-16,-8,-17,1,25,1,40,-37,-33,66,94,53,4,-22,-25,-41,-42,25,35,-16,-15,57,31,-29,-32,21,16,-60,45,15,-1,7,57,-26,-47,-29,11,8,15,19,-105,-8,54,27,10,-17,6,-12,-1,-10,4,0,23,-10,31,13,11,10,12,-64,23,-3,-8,-19,16,52,24,-40,16,10,40,5,9,0,-13,-7,-21,-8,-6,-7,-21,59,16,-53,18,-60,11,-47,14,-18,25,-13,-24,4,-39,16,-28,54,26,-67,30,27,-20,-52,20,-12,55,12,18,-16,39,-14,-6,-26,56,-88,-55,12,25,26,-37,6,75,0,-34,-81,54,-30,1,-7,49,-23,-14,21,10,-62,-58,-57,-47,-34,15,-4,34,-78,31,25,-11,7,50,-10,42,-63,14,-36,-4,57,55,57,53,42,-42,-1,15,40,37,15,25,-11,6,1,31,-2,-6,-1,-7,-64,34,28,30,-1,3,21,0,-88,-12,-56,25,-28,40,8,-28,-14,9,12,2,-6,-17,22,49,-6,-26,14,28,-20,4,-12,50,35,40,13,-38,-58,-29,17,30,22,60,26,-54,-39,-12,58,-28,-63,10,-21,-8,-12,26,-62,6,-10,-11,-22,-6,-7,4,1,18,2,-70,11,14,4,13,19,-24,-34,24,67,17,51,-21,13,23,54,-30,48,1,-13,80,26,-16,-2,13,-4,6,-30,29,-24,73,-58,30,-27,20,-2,-21,41,45,30,-27,-3,-5,-18,-20,-49,-3,-35,10,42,-19,-67,-53,-11,9,13,-15,-33,-51,-30,15,7,25,-30,4,28,-22,-34,54,-29,39,-46,20,16,34,-4,47,75,1,-44,-55,-24,7,-1,9,-42,50,-8,-36,41,68,0,-4,-10,-23,-15,-50,64,36,-9,-27,12,25,-38,-47,-37,32,-49,51,-36,2,-4,69,-26,19,7,45,67,46,13,-63,46,15,-47,4,-41,13,-6,5,-21,37,26,-55,-7,33,-1,-28,10,-17,-64,-14,0,-36,-17,93,-3,-9,-66,44,-21,3,-12,38,-6,-13,-12,19,13,43,-43,-10,-12,6,-5,9,-49,32,-5,2,4,5,15,-16,10,-21,8,-62,-8,64,8,79,-1,-66,-49,-18,5,40,-5,-30,-45,1,-6,21,-32,93,-18,-30,-21,32,21,-18,22,8,5,-41,-54,80,22,-10,-7,-8,-23,-64,66,56,-14,-30,-41,-46,-14,-29,-37,27,-14,42,-2,-9,-29,34,14,33,-14,22,4,10,26,26,28,32,23,-72,-32,3,0,-14,35,-42,-78,-32,6,29,-18,-45,-5,7,-33,-45,-3,-22,-34,8,-8,4,-51,-25,-9,59,-78,21,-5,-25,-48,66,-15,-17,-24,-49,-13,25,-23,-64,-6,40,-24,-19,-11,57,-33,-8,1,10,-52,-54,28,39,49,34,-11,-61,-41,-43,10,15,-15,51,30,15,-51,32,-34,-2,-34,14,18,16,1,1,-3,-3,1,1,-18,6,16,48,12,-5,-42,7,36,48,7,-20,-10,7,12,2,54,39,-38,37,54,4,-11,-8,-46,-10,5,-10,-34,46,-12,29,-37,39,36,-11,24,56,17,14,20,25,0,-25,-28,55,-7,-5,27,3,9,-26,-8,6,-24,-10,-30,-31,-34,18,4,22,21,40,-1,-29,-37,-8,-21,92,-29,11,-3,11,73,23,22,7,4,-44,-9,-11,21,-13,11,9,-78,-1,47,114,-12,-37,-19,-5,-11,-22,19,12,-30,7,38,45,-21,-8,-9,55,-45,56,-21,7,17,46,-57,-87,-6,27,31,31,7,-56,-12,46,21,-5,-12,36,3,3,-21,43,19,12,-7,9,-14,0,-9,-33,-91,7,26,3,-11,64,83,-31,-46,25,2,9,5,2,2,-1,20,-17,10,-5,-27,-8,20,8,-19,16,-21,-13,-31,5,5,42,24,9,34,-20,28,-61,22,11,-39,64,-20,-1,-30,-9,-20,24,-25,-24,-29,22,-60,6,-5,41,-9,-87,14,34,15,-57,52,69,15,-3,-102,58,16,3,6,60,-75,-32,26,7,-57,-27,-32,-24,-21,-29,-16,62,-46,31,30,-27,-15,7,15],Codebook_Constants.exc_5_64_table=[1,5,-15,49,-66,-48,-4,50,-44,7,37,16,-18,25,-26,-26,-15,19,19,-27,-47,28,57,5,-17,-32,-41,68,21,-2,64,56,8,-16,-13,-26,-9,-16,11,6,-39,25,-19,22,-31,20,-45,55,-43,10,-16,47,-40,40,-20,-51,3,-17,-14,-15,-24,53,-20,-46,46,27,-68,32,3,-18,-5,9,-31,16,-9,-10,-1,-23,48,95,47,25,-41,-32,-3,15,-25,-55,36,41,-27,20,5,13,14,-22,5,2,-23,18,46,-15,17,-18,-34,-5,-8,27,-55,73,16,2,-1,-17,40,-78,33,0,2,19,4,53,-16,-15,-16,-28,-3,-13,49,8,-7,-29,27,-13,32,20,32,-61,16,14,41,44,40,24,20,7,4,48,-60,-77,17,-6,-48,65,-15,32,-30,-71,-10,-3,-6,10,-2,-7,-29,-56,67,-30,7,-5,86,-6,-10,0,5,-31,60,34,-38,-3,24,10,-2,30,23,24,-41,12,70,-43,15,-17,6,13,16,-13,8,30,-15,-8,5,23,-34,-98,-4,-13,13,-48,-31,70,12,31,25,24,-24,26,-7,33,-16,8,5,-11,-14,-8,-65,13,10,-2,-9,0,-3,-68,5,35,7,0,-31,-1,-17,-9,-9,16,-37,-18,-1,69,-48,-28,22,-21,-11,5,49,55,23,-86,-36,16,2,13,63,-51,30,-11,13,24,-18,-6,14,-19,1,41,9,-5,27,-36,-44,-34,-37,-21,-26,31,-39,15,43,5,-8,29,20,-8,-20,-52,-28,-1,13,26,-34,-10,-9,27,-8,8,27,-66,4,12,-22,49,10,-77,32,-18,3,-38,12,-3,-1,2,2,0],Codebook_Constants.exc_8_128_table=[-14,9,13,-32,2,-10,31,-10,-8,-8,6,-4,-1,10,-64,23,6,20,13,6,8,-22,16,34,7,42,-49,-28,5,26,4,-15,41,34,41,32,33,24,23,14,8,40,34,4,-24,-41,-19,-15,13,-13,33,-54,24,27,-44,33,27,-15,-15,24,-19,14,-36,14,-9,24,-12,-4,37,-5,16,-34,5,10,33,-15,-54,-16,12,25,12,1,2,0,3,-1,-4,-4,11,2,-56,54,27,-20,13,-6,-46,-41,-33,-11,-5,7,12,14,-14,-5,8,20,6,3,4,-8,-5,-42,11,8,-14,25,-2,2,13,11,-22,39,-9,9,5,-45,-9,7,-9,12,-7,34,-17,-102,7,2,-42,18,35,-9,-34,11,-5,-2,3,22,46,-52,-25,-9,-94,8,11,-5,-5,-5,4,-7,-35,-7,54,5,-32,3,24,-9,-22,8,65,37,-1,-12,-23,-6,-9,-28,55,-33,14,-3,2,18,-60,41,-17,8,-16,17,-11,0,-11,29,-28,37,9,-53,33,-14,-9,7,-25,-7,-11,26,-32,-8,24,-21,22,-19,19,-10,29,-14,-10,-4,-3,-2,3,-1,-4,-4,-5,-52,10,41,6,-30,-4,16,32,22,-27,-22,32,-3,-28,-3,3,-35,6,17,23,21,8,2,4,-45,-17,14,23,-4,-31,-11,-3,14,1,19,-11,2,61,-8,9,-12,7,-10,12,-3,-24,99,-48,23,50,-37,-5,-23,0,8,-14,35,-64,-5,46,-25,13,-1,-49,-19,-15,9,34,50,25,11,-6,-9,-16,-20,-32,-33,-32,-27,10,-8,12,-15,56,-14,-32,33,3,-9,1,65,-9,-9,-10,-2,-6,-23,9,17,3,-28,13,-32,4,-2,-10,4,-16,76,12,-52,6,13,33,-6,4,-14,-9,-3,1,-15,-16,28,1,-15,11,16,9,4,-21,-37,-40,-6,22,12,-15,-23,-14,-17,-16,-9,-10,-9,13,-39,41,5,-9,16,-38,25,46,-47,4,49,-14,17,-2,6,18,5,-6,-33,-22,44,50,-2,1,3,-6,7,7,-3,-21,38,-18,34,-14,-41,60,-13,6,16,-24,35,19,-13,-36,24,3,-17,-14,-10,36,44,-44,-29,-3,3,-54,-8,12,55,26,4,-2,-5,2,-11,22,-23,2,22,1,-25,-39,66,-49,21,-8,-2,10,-14,-60,25,6,10,27,-25,16,5,-2,-9,26,-13,-20,58,-2,7,52,-9,2,5,-4,-15,23,-1,-38,23,8,27,-6,0,-27,-7,39,-10,-14,26,11,-45,-12,9,-5,34,4,-35,10,43,-22,-11,56,-7,20,1,10,1,-26,9,94,11,-27,-14,-13,1,-11,0,14,-5,-6,-10,-4,-15,-8,-41,21,-5,1,-28,-8,22,-9,33,-23,-4,-4,-12,39,4,-7,3,-60,80,8,-17,2,-6,12,-5,1,9,15,27,31,30,27,23,61,47,26,10,-5,-8,-12,-13,5,-18,25,-15,-4,-15,-11,12,-2,-2,-16,-2,-6,24,12,11,-4,9,1,-9,14,-45,57,12,20,-35,26,11,-64,32,-10,-10,42,-4,-9,-16,32,24,7,10,52,-11,-57,29,0,8,0,-6,17,-17,-56,-40,7,20,18,12,-6,16,5,7,-1,9,1,10,29,12,16,13,-2,23,7,9,-3,-4,-5,18,-64,13,55,-25,9,-9,24,14,-25,15,-11,-40,-30,37,1,-19,22,-5,-31,13,-2,0,7,-4,16,-67,12,66,-36,24,-8,18,-15,-23,19,0,-45,-7,4,3,-13,13,35,5,13,33,10,27,23,0,-7,-11,43,-74,36,-12,2,5,-8,6,-33,11,-16,-14,-5,-7,-3,17,-34,27,-16,11,-9,15,33,-31,8,-16,7,-6,-7,63,-55,-17,11,-1,20,-46,34,-30,6,9,19,28,-9,5,-24,-8,-23,-2,31,-19,-16,-5,-15,-18,0,26,18,37,-5,-15,-2,17,5,-27,21,-33,44,12,-27,-9,17,11,25,-21,-31,-7,13,33,-8,-25,-7,7,-10,4,-6,-9,48,-82,-23,-8,6,11,-23,3,-3,49,-29,25,31,4,14,16,9,-4,-18,10,-26,3,5,-44,-9,9,-47,-55,15,9,28,1,4,-3,46,6,-6,-38,-29,-31,-15,-6,3,0,14,-6,8,-54,-50,33,-5,1,-14,33,-48,26,-4,-5,-3,-5,-3,-5,-28,-22,77,55,-1,2,10,10,-9,-14,-66,-49,11,-36,-6,-20,10,-10,16,12,4,-1,-16,45,-44,-50,31,-2,25,42,23,-32,-22,0,11,20,-40,-35,-40,-36,-32,-26,-21,-13,52,-22,6,-24,-20,17,-5,-8,36,-25,-11,21,-26,6,34,-8,7,20,-3,5,-25,-8,18,-5,-9,-4,1,-9,20,20,39,48,-24,9,5,-65,22,29,4,3,-43,-11,32,-6,9,19,-27,-10,-47,-14,24,10,-7,-36,-7,-1,-4,-5,-5,16,53,25,-26,-29,-4,-12,45,-58,-34,33,-5,2,-1,27,-48,31,-15,22,-5,4,7,7,-25,-3,11,-22,16,-12,8,-3,7,-11,45,14,-73,-19,56,-46,24,-20,28,-12,-2,-1,-36,-3,-33,19,-6,7,2,-15,5,-31,-45,8,35,13,20,0,-9,48,-13,-43,-3,-13,2,-5,72,-68,-27,2,1,-2,-7,5,36,33,-40,-12,-4,-5,23,19],Codebook_Constants.gain_cdbk_nb=[-32,-32,-32,-28,-67,-5,-42,-6,-32,-57,-10,-54,-16,27,-41,19,-19,-40,-45,24,-21,-8,-14,-18,1,14,-58,-18,-88,-39,-38,21,-18,-19,20,-43,10,17,-48,-52,-58,-13,-44,-1,-11,-12,-11,-34,14,0,-46,-37,-35,-34,-25,44,-30,6,-4,-63,-31,43,-41,-23,30,-43,-43,26,-14,-33,1,-13,-13,18,-37,-46,-73,-45,-36,24,-25,-36,-11,-20,-25,12,-18,-36,-69,-59,-45,6,8,-22,-14,-24,-1,13,-44,-39,-48,-26,-32,31,-37,-33,15,-46,-24,30,-36,-41,31,-23,-50,22,-4,-22,2,-21,-17,30,-34,-7,-60,-28,-38,42,-28,-44,-11,21,-16,8,-44,-39,-55,-43,-11,-35,26,-9,0,-34,-8,121,-81,7,-16,-22,-37,33,-31,-27,-7,-36,-34,70,-57,-37,-11,-48,-40,17,-1,-33,6,-6,-9,0,-20,-21,69,-33,-29,33,-31,-55,12,-1,-33,27,-22,-50,-33,-47,-50,54,51,-1,-5,-44,-4,22,-40,-39,-66,-25,-33,1,-26,-24,-23,-25,-11,21,-45,-25,-45,-19,-43,105,-16,5,-21,1,-16,11,-33,-13,-99,-4,-37,33,-15,-25,37,-63,-36,24,-31,-53,-56,-38,-41,-4,4,-33,13,-30,49,52,-94,-5,-30,-15,1,38,-40,-23,12,-36,-17,40,-47,-37,-41,-39,-49,34,0,-18,-7,-4,-16,17,-27,30,5,-62,4,48,-68,-43,11,-11,-18,19,-15,-23,-62,-39,-42,10,-2,-21,-13,-13,-9,13,-47,-23,-62,-24,-44,60,-21,-18,-3,-52,-22,22,-36,-75,57,16,-19,3,10,-29,23,-38,-5,-62,-51,-51,40,-18,-42,13,-24,-34,14,-20,-56,-75,-26,-26,32,15,-26,17,-29,-7,28,-52,-12,-30,5,-5,-48,-5,2,2,-43,21,16,16,-25,-45,-32,-43,18,-10,9,0,-1,-1,7,-30,19,-48,-4,-28,25,-29,-22,0,-31,-32,17,-10,-64,-41,-62,-52,15,16,-30,-22,-32,-7,9,-38],Codebook_Constants.gain_cdbk_lbr=[-32,-32,-32,-31,-58,-16,-41,-24,-43,-56,-22,-55,-13,33,-41,-4,-39,-9,-41,15,-12,-8,-15,-12,1,2,-44,-22,-66,-42,-38,28,-23,-21,14,-37,0,21,-50,-53,-71,-27,-37,-1,-19,-19,-5,-28,6,65,-44,-33,-48,-33,-40,57,-14,-17,4,-45,-31,38,-33,-23,28,-40,-43,29,-12,-34,13,-23,-16,15,-27,-14,-82,-15,-31,25,-32,-21,5,-5,-47,-63,-51,-46,12,3,-28,-17,-29,-10,14,-40],Codebook_Constants.hexc_10_32_table=[-3,-2,-1,0,-4,5,35,-40,-9,13,-44,5,-27,-1,-7,6,-11,7,-8,7,19,-14,15,-4,9,-10,10,-8,10,-9,-1,1,0,0,2,5,-18,22,-53,50,1,-23,50,-36,15,3,-13,14,-10,6,1,5,-3,4,-2,5,-32,25,5,-2,-1,-4,1,11,-29,26,-6,-15,30,-18,0,15,-17,40,-41,3,9,-2,-2,3,-3,-1,-5,2,21,-6,-16,-21,23,2,60,15,16,-16,-9,14,9,-1,7,-9,0,1,1,0,-1,-6,17,-28,54,-45,-1,1,-1,-6,-6,2,11,26,-29,-2,46,-21,34,12,-23,32,-23,16,-10,3,66,19,-20,24,7,11,-3,0,-3,-1,-50,-46,2,-18,-3,4,-1,-2,3,-3,-19,41,-36,9,11,-24,21,-16,9,-3,-25,-3,10,18,-9,-2,-5,-1,-5,6,-4,-3,2,-26,21,-19,35,-15,7,-13,17,-19,39,-43,48,-31,16,-9,7,-2,-5,3,-4,9,-19,27,-55,63,-35,10,26,-44,-2,9,4,1,-6,8,-9,5,-8,-1,-3,-16,45,-42,5,15,-16,10,0,0,0,0,0,0,0,0,0,0,-16,24,-55,47,-38,27,-19,7,-3,1,16,27,20,-19,18,5,-7,1,-5,2,-6,8,-22,0,-3,-3,8,-1,7,-8,1,-3,5,0,17,-48,58,-52,29,-7,-2,3,-10,6,-26,58,-31,1,-6,3,93,-29,39,3,17,5,6,-1,-1,-1,27,13,10,19,-7,-34,12,10,-4,9,-76,9,8,-28,-2,-11,2,-1,3,1,-83,38,-39,4,-16,-6,-2,-5,5,-2],Codebook_Constants.hexc_table=[-24,21,-20,5,-5,-7,14,-10,2,-27,16,-20,0,-32,26,19,8,-11,-41,31,28,-27,-32,34,42,34,-17,22,-10,13,-29,18,-12,-26,-24,11,22,5,-5,-5,54,-68,-43,57,-25,24,4,4,26,-8,-12,-17,54,30,-45,1,10,-15,18,-41,11,68,-67,37,-16,-24,-16,38,-22,6,-29,30,66,-27,5,7,-16,13,2,-12,-7,-3,-20,36,4,-28,9,3,32,48,26,39,3,0,7,-21,-13,5,-82,-7,73,-20,34,-9,-5,1,-1,10,-5,-10,-1,9,1,-9,10,0,-14,11,-1,-2,-1,11,20,96,-81,-22,-12,-9,-58,9,24,-30,26,-35,27,-12,13,-18,56,-59,15,-7,23,-15,-1,6,-25,14,-22,-20,47,-11,16,2,38,-23,-19,-30,-9,40,-11,5,4,-6,8,26,-21,-11,127,4,1,6,-9,2,-7,-2,-3,7,-5,10,-19,7,-106,91,-3,9,-4,21,-8,26,-80,8,1,-2,-10,-17,-17,-27,32,71,6,-29,11,-23,54,-38,29,-22,39,87,-31,-12,-20,3,-2,-2,2,20,0,-1,-35,27,9,-6,-12,3,-12,-6,13,1,14,-22,-59,-15,-17,-25,13,-7,7,3,0,1,-7,6,-3,61,-37,-23,-23,-29,38,-31,27,1,-8,2,-27,23,-26,36,-34,5,24,-24,-6,7,3,-59,78,-62,44,-16,1,6,0,17,8,45,0,-110,6,14,-2,32,-77,-56,62,-3,3,-13,4,-16,102,-15,-36,-1,9,-113,6,23,0,9,9,5,-8,-1,-14,5,-12,121,-53,-27,-8,-9,22,-13,3,2,-3,1,-2,-71,95,38,-19,15,-16,-5,71,10,2,-32,-13,-5,15,-1,-2,-14,-85,30,29,6,3,2,0,0,0,0,0,0,0,0,2,-65,-56,-9,18,18,23,-14,-2,0,12,-29,26,-12,1,2,-12,-64,90,-6,4,1,5,-5,-110,-3,-31,22,-29,9,0,8,-40,-5,21,-5,-5,13,10,-18,40,1,35,-20,30,-28,11,-6,19,7,14,18,-64,9,-6,16,51,68,8,16,12,-8,0,-9,20,-22,25,7,-4,-13,41,-35,93,-18,-54,11,-1,1,-9,4,-66,66,-31,20,-22,25,-23,11,10,9,19,15,11,-5,-31,-10,-23,-28,-6,-6,-3,-4,5,3,-28,22,-11,-42,25,-25,-16,41,34,47,-6,2,42,-19,-22,5,-39,32,6,-35,22,17,-30,8,-26,-11,-11,3,-12,33,33,-37,21,-1,6,-4,3,0,-5,5,12,-12,57,27,-61,-3,20,-17,2,0,4,0,-2,-33,-58,81,-23,39,-10,-5,2,6,-7,5,4,-3,-2,-13,-23,-72,107,15,-5,0,-7,-3,-6,5,-4,15,47,12,-31,25,-16,8,22,-25,-62,-56,-18,14,28,12,2,-11,74,-66,41,-20,-7,16,-20,16,-8,0,-16,4,-19,92,12,-59,-14,-39,49,-25,-16,23,-27,19,-3,-33,19,85,-29,6,-7,-10,16,-7,-12,1,-6,2,4,-2,64,10,-25,41,-2,-31,15,0,110,50,69,35,28,19,-10,2,-43,-49,-56,-15,-16,10,3,12,-1,-8,1,26,-12,-1,7,-11,-27,41,25,1,-11,-18,22,-7,-1,-47,-8,23,-3,-17,-7,18,-125,59,-5,3,18,1,2,3,27,-35,65,-53,50,-46,37,-21,-28,7,14,-37,-5,-5,12,5,-8,78,-19,21,-6,-16,8,-7,5,2,7,2,10,-6,12,-60,44,11,-36,-32,31,0,2,-2,2,1,-3,7,-10,17,-21,10,6,-2,19,-2,59,-38,-86,38,8,-41,-30,-45,-33,7,15,28,29,-7,24,-40,7,7,5,-2,9,24,-23,-18,6,-29,30,2,28,49,-11,-46,10,43,-13,-9,-1,-3,-7,-7,-17,-6,97,-33,-21,3,5,1,12,-43,-8,28,7,-43,-7,17,-20,19,-1,2,-13,9,54,34,9,-28,-11,-9,-17,110,-59,44,-26,0,3,-12,-47,73,-34,-43,38,-33,16,-5,-46,-4,-6,-2,-25,19,-29,28,-13,5,14,27,-40,-43,4,32,-13,-2,-35,-4,112,-42,9,-12,37,-28,17,14,-19,35,-39,23,3,-14,-1,-57,-5,94,-9,3,-39,5,30,-10,-32,42,-13,-14,-97,-63,30,-9,1,-7,12,5,20,17,-9,-36,-30,25,47,-9,-15,12,-22,98,-8,-50,15,-27,21,-16,-11,2,12,-10,10,-3,33,36,-96,0,-17,31,-9,9,3,-20,13,-11,8,-4,10,-10,9,1,112,-70,-27,5,-21,2,-57,-3,-29,10,19,-21,21,-10,-66,-3,91,-35,30,-12,0,-7,59,-28,26,2,14,-18,1,1,11,17,20,-54,-59,27,4,29,32,5,19,12,-4,1,7,-10,5,-2,10,0,23,-5,28,-104,46,11,16,3,29,1,-8,-14,1,7,-50,88,-62,26,8,-17,-14,50,0,32,-12,-3,-27,18,-8,-5,8,3,-20,-11,37,-12,9,33,46,-101,-1,-4,1,6,-1,28,-42,-15,16,5,-1,-2,-55,85,38,-9,-4,11,-2,-9,-6,3,-20,-10,-77,89,24,-3,-104,-57,-26,-31,-20,-6,-9,14,20,-23,46,-15,-31,28,1,-15,-2,6,-2,31,45,-76,23,-25],Codebook_Constants.high_lsp_cdbk=[39,12,-14,-20,-29,-61,-67,-76,-32,-71,-67,68,77,46,34,5,-13,-48,-46,-72,-81,-84,-60,-58,-40,-28,82,93,68,45,29,3,-19,-47,-28,-43,-35,-30,-8,-13,-39,-91,-91,-123,-96,10,10,-6,-18,-55,-60,-91,-56,-36,-27,-16,-48,-75,40,28,-10,-28,35,9,37,19,1,-20,-31,-41,-18,-25,-35,-68,-80,45,27,-1,47,13,0,-29,-35,-57,-50,-79,-73,-38,-19,5,35,14,-10,-23,16,-8,5,-24,-40,-62,-23,-27,-22,-16,-18,-46,-72,-77,43,21,33,1,-80,-70,-70,-64,-56,-52,-39,-33,-31,-38,-19,-19,-15,32,33,-2,7,-15,-15,-24,-23,-33,-41,-56,-24,-57,5,89,64,41,27,5,-9,-47,-60,-97,-97,-124,-20,-9,-44,-73,31,29,-4,64,48,7,-35,-57,0,-3,-26,-47,-3,-6,-40,-76,-79,-48,12,81,55,10,9,-24,-43,-73,-57,-69,16,5,-28,-53,18,29,20,0,-4,-11,6,-13,23,7,-17,-35,-37,-37,-30,-68,-63,6,24,-9,-14,3,21,-13,-27,-57,-49,-80,-24,-41,-5,-16,-5,1,45,25,12,-7,3,-15,-6,-16,-15,-8,6,-13,-42,-81,-80,-87,14,1,-10,-3,-43,-69,-46,-24,-28,-29,36,6,-43,-56,-12,12,54,79,43,9,54,22,2,8,-12,-43,-46,-52,-38,-69,-89,-5,75,38,33,5,-13,-53,-62,-87,-89,-113,-99,-55,-34,-37,62,55,33,16,21,-2,-17,-46,-29,-38,-38,-48,-39,-42,-36,-75,-72,-88,-48,-30,21,2,-15,-57,-64,-98,-84,-76,25,1,-46,-80,-12,18,-7,3,34,6,38,31,23,4,-1,20,14,-15,-43,-78,-91,-24,14,-3,54,16,0,-27,-28,-44,-56,-83,-92,-89,-3,34,56,41,36,22,20,-8,-7,-35,-42,-62,-49,3,12,-10,-50,-87,-96,-66,92,70,38,9,-70,-71,-62,-42,-39,-43,-11,-7,-50,-79,-58,-50,-31,32,31,-6,-4,-25,7,-17,-38,-70,-58,-27,-43,-83,-28,59,36,20,31,2,-27,-71,-80,-109,-98,-75,-33,-32,-31,-2,33,15,-6,43,33,-5,0,-22,-10,-27,-34,-49,-11,-20,-41,-91,-100,-121,-39,57,41,10,-19,-50,-38,-59,-60,-70,-18,-20,-8,-31,-8,-15,1,-14,-26,-25,33,21,32,17,1,-19,-19,-26,-58,-81,-35,-22,45,30,11,-11,3,-26,-48,-87,-67,-83,-58,3,-1,-26,-20,44,10,25,39,5,-9,-35,-27,-38,7,10,4,-9,-42,-85,-102,-127,52,44,28,10,-47,-61,-40,-39,-17,-1,-10,-33,-42,-74,-48,21,-4,70,52,10],Codebook_Constants.high_lsp_cdbk2=[-36,-62,6,-9,-10,-14,-56,23,1,-26,23,-48,-17,12,8,-7,23,29,-36,-28,-6,-29,-17,-5,40,23,10,10,-46,-13,36,6,4,-30,-29,62,32,-32,-1,22,-14,1,-4,-22,-45,2,54,4,-30,-57,-59,-12,27,-3,-31,8,-9,5,10,-14,32,66,19,9,2,-25,-37,23,-15,18,-38,-31,5,-9,-21,15,0,22,62,30,15,-12,-14,-46,77,21,33,3,34,29,-19,50,2,11,9,-38,-12,-37,62,1,-15,54,32,6,2,-24,20,35,-21,2,19,24,-13,55,4,9,39,-19,30,-1,-21,73,54,33,8,18,3,15,6,-19,-47,6,-3,-48,-50,1,26,20,8,-23,-50,65,-14,-55,-17,-31,-37,-28,53,-1,-17,-53,1,57,11,-8,-25,-30,-37,64,5,-52,-45,15,23,31,15,14,-25,24,33,-2,-44,-56,-18,6,-21,-43,4,-12,17,-37,20,-10,34,15,2,15,55,21,-11,-31,-6,46,25,16,-9,-25,-8,-62,28,17,20,-32,-29,26,30,25,-19,2,-16,-17,26,-51,2,50,42,19,-66,23,29,-2,3,19,-19,-37,32,15,6,30,-34,13,11,-5,40,31,10,-42,4,-9,26,-9,-70,17,-2,-23,20,-22,-55,51,-24,-31,22,-22,15,-13,3,-10,-28,-16,56,4,-63,11,-18,-15,-18,-38,-35,16,-7,34,-1,-21,-49,-47,9,-37,7,8,69,55,20,6,-33,-45,-10,-9,6,-9,12,71,15,-3,-42,-7,-24,32,-35,-2,-42,-17,-5,0,-2,-33,-54,13,-12,-34,47,23,19,55,7,-8,74,31,14,16,-23,-26,19,12,-18,-49,-28,-31,-20,2,-14,-20,-47,78,40,13,-23,-11,21,-6,18,1,47,5,38,35,32,46,22,8,13,16,-14,18,51,19,40,39,11,-26,-1,-17,47,2,-53,-15,31,-22,38,21,-15,-16,5,-33,53,15,-38,86,11,-3,-24,49,13,-4,-11,-18,28,20,-12,-27,-26,35,-25,-35,-3,-20,-61,30,10,-55,-12,-22,-52,-54,-14,19,-32,-12,45,15,-8,-48,-9,11,-32,8,-16,-34,-13,51,18,38,-2,-32,-17,22,-2,-18,-28,-70,59,27,-28,-19,-10,-20,-9,-9,-8,-21,21,-8,35,-2,45,-3,-9,12,0,30,7,-39,43,27,-38,-91,30,26,19,-55,-4,63,14,-17,13,9,13,2,7,4,6,61,72,-1,-17,29,-1,-22,-17,8,-28,-37,63,44,41,3,2,14,9,-6,75,-8,-7,-12,-15,-12,13,9,-4,30,-22,-65,15,0,-45,4,-4,1,5,22,11,23],Codebook_Constants.NB_CDBK_SIZE=64,Codebook_Constants.NB_CDBK_SIZE_LOW1=64,Codebook_Constants.NB_CDBK_SIZE_LOW2=64,Codebook_Constants.NB_CDBK_SIZE_HIGH1=64,Codebook_Constants.NB_CDBK_SIZE_HIGH2=64,Codebook_Constants.cdbk_nb=[30,19,38,34,40,32,46,43,58,43,5,-18,-25,-40,-33,-55,-52,20,34,28,-20,-63,-97,-92,61,53,47,49,53,75,-14,-53,-77,-79,0,-3,-5,19,22,26,-9,-53,-55,66,90,72,85,68,74,52,-4,-41,-58,-31,-18,-31,27,32,30,18,24,3,8,5,-12,-3,26,28,74,63,-2,-39,-67,-77,-106,-74,59,59,73,65,44,40,71,72,82,83,98,88,89,60,-6,-31,-47,-48,-13,-39,-9,7,2,79,-1,-39,-60,-17,87,81,65,50,45,19,-21,-67,-91,-87,-41,-50,7,18,39,74,10,-31,-28,39,24,13,23,5,56,45,29,10,-5,-13,-11,-35,-18,-8,-10,-8,-25,-71,-77,-21,2,16,50,63,87,87,5,-32,-40,-51,-68,0,12,6,54,34,5,-12,32,52,68,64,69,59,65,45,14,-16,-31,-40,-65,-67,41,49,47,37,-11,-52,-75,-84,-4,57,48,42,42,33,-11,-51,-68,-6,13,0,8,-8,26,32,-23,-53,0,36,56,76,97,105,111,97,-1,-28,-39,-40,-43,-54,-44,-40,-18,35,16,-20,-19,-28,-42,29,47,38,74,45,3,-29,-48,-62,-80,-104,-33,56,59,59,10,17,46,72,84,101,117,123,123,106,-7,-33,-49,-51,-70,-67,-27,-31,70,67,-16,-62,-85,-20,82,71,86,80,85,74,-19,-58,-75,-45,-29,-33,-18,-25,45,57,-12,-42,-5,12,28,36,52,64,81,82,13,-9,-27,-28,22,3,2,22,26,6,-6,-44,-51,2,15,10,48,43,49,34,-19,-62,-84,-89,-102,-24,8,17,61,68,39,24,23,19,16,-5,12,15,27,15,-8,-44,-49,-60,-18,-32,-28,52,54,62,-8,-48,-77,-70,66,101,83,63,61,37,-12,-50,-75,-64,33,17,13,25,15,77,1,-42,-29,72,64,46,49,31,61,44,-8,-47,-54,-46,-30,19,20,-1,-16,0,16,-12,-18,-9,-26,-27,-10,-22,53,45,-10,-47,-75,-82,-105,-109,8,25,49,77,50,65,114,117,124,118,115,96,90,61,-9,-45,-63,-60,-75,-57,8,11,20,29,0,-35,-49,-43,40,47,35,40,55,38,-24,-76,-103,-112,-27,3,23,34,52,75,8,-29,-43,12,63,38,35,29,24,8,25,11,1,-15,-18,-43,-7,37,40,21,-20,-56,-19,-19,-4,-2,11,29,51,63,-2,-44,-62,-75,-89,30,57,51,74,51,50,46,68,64,65,52,63,55,65,43,18,-9,-26,-35,-55,-69,3,6,8,17,-15,-61,-86,-97,1,86,93,74,78,67,-1,-38,-66,-48,48,39,29,25,17,-1,13,13,29,39,50,51,69,82,97,98,-2,-36,-46,-27,-16,-30,-13,-4,-7,-4,25,-5,-11,-6,-25,-21,33,12,31,29,-8,-38,-52,-63,-68,-89,-33,-1,10,74,-2,-15,59,91,105,105,101,87,84,62,-7,-33,-50,-35,-54,-47,25,17,82,81,-13,-56,-83,21,58,31,42,25,72,65,-24,-66,-91,-56,9,-2,21,10,69,75,2,-24,11,22,25,28,38,34,48,33,7,-29,-26,17,15,-1,14,0,-2,0,-6,-41,-67,6,-2,-9,19,2,85,74,-22,-67,-84,-71,-50,3,11,-9,2,62],Codebook_Constants.cdbk_nb_low1=[-34,-52,-15,45,2,23,21,52,24,-33,-9,-1,9,-44,-41,-13,-17,44,22,-17,-6,-4,-1,22,38,26,16,2,50,27,-35,-34,-9,-41,6,0,-16,-34,51,8,-14,-31,-49,15,-33,45,49,33,-11,-37,-62,-54,45,11,-5,-72,11,-1,-12,-11,24,27,-11,-43,46,43,33,-12,-9,-1,1,-4,-23,-57,-71,11,8,16,17,-8,-20,-31,-41,53,48,-16,3,65,-24,-8,-23,-32,-37,-32,-49,-10,-17,6,38,5,-9,-17,-46,8,52,3,6,45,40,39,-7,-6,-34,-74,31,8,1,-16,43,68,-11,-19,-31,4,6,0,-6,-17,-16,-38,-16,-30,2,9,-39,-16,-1,43,-10,48,3,3,-16,-31,-3,62,68,43,13,3,-10,8,20,-56,12,12,-2,-18,22,-15,-40,-36,1,7,41,0,1,46,-6,-62,-4,-12,-2,-11,-83,-13,-2,91,33,-10,0,4,-11,-16,79,32,37,14,9,51,-21,-28,-56,-34,0,21,9,-26,11,28,-42,-54,-23,-2,-15,31,30,8,-39,-66,-39,-36,31,-28,-40,-46,35,40,22,24,33,48,23,-34,14,40,32,17,27,-3,25,26,-13,-61,-17,11,4,31,60,-6,-26,-41,-64,13,16,-26,54,31,-11,-23,-9,-11,-34,-71,-21,-34,-35,55,50,29,-22,-27,-50,-38,57,33,42,57,48,26,11,0,-49,-31,26,-4,-14,5,78,37,17,0,-49,-12,-23,26,14,2,2,-43,-17,-12,10,-8,-4,8,18,12,-6,20,-12,-6,-13,-25,34,15,40,49,7,8,13,20,20,-19,-22,-2,-8,2,51,-51],Codebook_Constants.cdbk_nb_low2=[-6,53,-21,-24,4,26,17,-4,-37,25,17,-36,-13,31,3,-6,27,15,-10,31,28,26,-10,-10,-40,16,-7,15,13,41,-9,0,-4,50,-6,-7,14,38,22,0,-48,2,1,-13,-19,32,-3,-60,11,-17,-1,-24,-34,-1,35,-5,-27,28,44,13,25,15,42,-11,15,51,35,-36,20,8,-4,-12,-29,19,-47,49,-15,-4,16,-29,-39,14,-30,4,25,-9,-5,-51,-14,-3,-40,-32,38,5,-9,-8,-4,-1,-22,71,-3,14,26,-18,-22,24,-41,-25,-24,6,23,19,-10,39,-26,-27,65,45,2,-7,-26,-8,22,-12,16,15,16,-35,-5,33,-21,-8,0,23,33,34,6,21,36,6,-7,-22,8,-37,-14,31,38,11,-4,-3,-39,-32,-8,32,-23,-6,-12,16,20,-28,-4,23,13,-52,-1,22,6,-33,-40,-6,4,-62,13,5,-26,35,39,11,2,57,-11,9,-20,-28,-33,52,-5,-6,-2,22,-14,-16,-48,35,1,-58,20,13,33,-1,-74,56,-18,-22,-31,12,6,-14,4,-2,-9,-47,10,-3,29,-17,-5,61,14,47,-12,2,72,-39,-17,92,64,-53,-51,-15,-30,-38,-41,-29,-28,27,9,36,9,-35,-42,81,-21,20,25,-16,-5,-17,-35,21,15,-28,48,2,-2,9,-19,29,-40,30,-18,-18,18,-16,-57,15,-20,-12,-15,-37,-15,33,-39,21,-22,-13,35,11,13,-38,-63,29,23,-27,32,18,3,-26,42,33,-64,-66,-17,16,56,2,36,3,31,21,-41,-39,8,-57,14,37,-2,19,-36,-19,-23,-29,-16,1,-3,-8,-10,31,64,-65],Codebook_Constants.cdbk_nb_high1=[-26,-8,29,21,4,19,-39,33,-7,-36,56,54,48,40,29,-4,-24,-42,-66,-43,-60,19,-2,37,41,-10,-37,-60,-64,18,-22,77,73,40,25,4,19,-19,-66,-2,11,5,21,14,26,-25,-86,-4,18,1,26,-37,10,37,-1,24,-12,-59,-11,20,-6,34,-16,-16,42,19,-28,-51,53,32,4,10,62,21,-12,-34,27,4,-48,-48,-50,-49,31,-7,-21,-42,-25,-4,-43,-22,59,2,27,12,-9,-6,-16,-8,-32,-58,-16,-29,-5,41,23,-30,-33,-46,-13,-10,-38,52,52,1,-17,-9,10,26,-25,-6,33,-20,53,55,25,-32,-5,-42,23,21,66,5,-28,20,9,75,29,-7,-42,-39,15,3,-23,21,6,11,1,-29,14,63,10,54,26,-24,-51,-49,7,-23,-51,15,-66,1,60,25,10,0,-30,-4,-15,17,19,59,40,4,-5,33,6,-22,-58,-70,-5,23,-6,60,44,-29,-16,-47,-29,52,-19,50,28,16,35,31,36,0,-21,6,21,27,22,42,7,-66,-40,-8,7,19,46,0,-4,60,36,45,-7,-29,-6,-32,-39,2,6,-9,33,20,-51,-34,18,-6,19,6,11,5,-19,-29,-2,42,-11,-45,-21,-55,57,37,2,-14,-67,-16,-27,-38,69,48,19,2,-17,20,-20,-16,-34,-17,-25,-61,10,73,45,16,-40,-64,-17,-29,-22,56,17,-39,8,-11,8,-25,-18,-13,-19,8,54,57,36,-17,-26,-4,6,-21,40,42,-4,20,31,53,10,-34,-53,31,-17,35,0,15,-6,-20,-63,-73,22,25,29,17,8,-29,-39,-69,18,15,-15,-5],Codebook_Constants.cdbk_nb_high2=[11,47,16,-9,-46,-32,26,-64,34,-5,38,-7,47,20,2,-73,-99,-3,-45,20,70,-52,15,-6,-7,-82,31,21,47,51,39,-3,9,0,-41,-7,-15,-54,2,0,27,-31,9,-45,-22,-38,-24,-24,8,-33,23,5,50,-36,-17,-18,-51,-2,13,19,43,12,-15,-12,61,38,38,7,13,0,6,-1,3,62,9,27,22,-33,38,-35,-9,30,-43,-9,-32,-1,4,-4,1,-5,-11,-8,38,31,11,-10,-42,-21,-37,1,43,15,-13,-35,-19,-18,15,23,-26,59,1,-21,53,8,-41,-50,-14,-28,4,21,25,-28,-40,5,-40,-41,4,51,-33,-8,-8,1,17,-60,12,25,-41,17,34,43,19,45,7,-37,24,-15,56,-2,35,-10,48,4,-47,-2,5,-5,-54,5,-3,-33,-10,30,-2,-44,-24,-38,9,-9,42,4,6,-56,44,-16,9,-40,-26,18,-20,10,28,-41,-21,-4,13,-18,32,-30,-3,37,15,22,28,50,-40,3,-29,-64,7,51,-19,-11,17,-27,-40,-64,24,-12,-7,-27,3,37,48,-1,2,-9,-38,-34,46,1,27,-6,19,-13,26,10,34,20,25,40,50,-6,-7,30,9,-24,0,-23,71,-61,22,58,-34,-4,2,-49,-33,25,30,-8,-6,-16,77,2,38,-8,-35,-6,-30,56,78,31,33,-20,13,-39,20,22,4,21,-8,4,-6,10,-83,-41,9,-25,-43,15,-7,-12,-34,-39,-37,-33,19,30,16,-33,42,-25,25,-68,44,-15,-11,-4,23,50,14,4,-39,-43,20,-30,60,9,-20,7,16,19,-33,37,29,16,-35,7,38,-27],Codebook_Constants.h0=[3596189e-11,-.0001123515,-.0001104587,.0002790277,.0002298438,-.0005953563,-.0003823631,.00113826,.0005308539,-.001986177,-.0006243724,.003235877,.0005743159,-.004989147,-.0002584767,.007367171,-.0004857935,-.01050689,.001894714,.01459396,-.004313674,-.01994365,.00828756,.02716055,-.01485397,-.03764973,.026447,.05543245,-.05095487,-.09779096,.1382363,.4600981,.4600981,.1382363,-.09779096,-.05095487,.05543245,.026447,-.03764973,-.01485397,.02716055,.00828756,-.01994365,-.004313674,.01459396,.001894714,-.01050689,-.0004857935,.007367171,-.0002584767,-.004989147,.0005743159,.003235877,-.0006243724,-.001986177,.0005308539,.00113826,-.0003823631,-.0005953563,.0002298438,.0002790277,-.0001104587,-.0001123515,3596189e-11],Codebook_Constants.h1=[3596189e-11,.0001123515,-.0001104587,-.0002790277,.0002298438,.0005953563,-.0003823631,-.00113826,.0005308539,.001986177,-.0006243724,-.003235877,.0005743159,.004989147,-.0002584767,-.007367171,-.0004857935,.01050689,.001894714,-.01459396,-.004313674,.01994365,.00828756,-.02716055,-.01485397,.03764973,.026447,-.05543245,-.05095487,.09779096,.1382363,-.4600981,.4600981,-.1382363,-.09779096,.05095487,.05543245,-.026447,-.03764973,.01485397,.02716055,-.00828756,-.01994365,.004313674,.01459396,-.001894714,-.01050689,.0004857935,.007367171,.0002584767,-.004989147,-.0005743159,.003235877,.0006243724,-.001986177,-.0005308539,.00113826,.0003823631,-.0005953563,-.0002298438,.0002790277,.0001104587,-.0001123515,-3596189e-11];var Bits=function(){var n,t,i;function a(e,r){for(var o=e;0<r;){var a;a=o>>r-1&1,n[t]|=a<<7-i,8==++i&&(i=0,t++),r--}}n=new Array,i=t=0,this.getBytes=function(){return n},this.Pack=function(e,r){a(e,r)},this.Write=function(e,r,o){return function(){for(0<i&&a(0,1);0!=i;)a(1,1)}(),ArrayCopy(n,0,e,r,o=t+(0<i?1:0)),o},this.Reset=function(){n=[],i=t=0}};function LbrLspQuant(){}function SubMode(e,r,o,a,n,t,i,f,s,_,c){this.LbrPitch=e,this.ForcedPitchGain=r,this.HaveSubframeGain=o,this.DoubleCodebook=a,this.LsqQuant=n,this.Ltp=t,this.Innovation=i,this.LpcEnhK1=f,this.LpcEnhK2=s,this.CombGain=_,this.BitsPerFrame=c}function NbLspQuant(){this.Quant=function(e,r,o,a){for(var n,t,i,f=new Array,s=0;s<LspQuant.MAX_LSP_SIZE;s++)f[s]=0;for(s=0;s<o;s++)r[s]=e[s];for(f[0]=1/(r[1]-r[0]),f[o-1]=1/(r[o-1]-r[o-2]),s=1;s<o-1;s++)n=1/((.15+r[s]-r[s-1])*(.15+r[s]-r[s-1])),t=1/((.15+r[s+1]-r[s])*(.15+r[s+1]-r[s])),f[s]=t<n?n:t;for(s=0;s<o;s++)r[s]-=.25*s+.25;for(s=0;s<o;s++)r[s]*=256;for(i=LspQuant.Lsp_quant(r,0,Codebook_Constants.cdbk_nb,Codebook_Constants.NB_CDBK_SIZE,o),a.Pack(i,6),s=0;s<o;s++)r[s]*=2;for(i=LspQuant.Lsp_weight_quant(r,0,f,0,Codebook_Constants.cdbk_nb_low1,Codebook_Constants.NB_CDBK_SIZE_LOW1,5),a.Pack(i,6),s=0;s<5;s++)r[s]*=2;for(i=LspQuant.Lsp_weight_quant(r,0,f,0,Codebook_Constants.cdbk_nb_low2,Codebook_Constants.NB_CDBK_SIZE_LOW2,5),a.Pack(i,6),i=LspQuant.Lsp_weight_quant(r,5,f,5,Codebook_Constants.cdbk_nb_high1,Codebook_Constants.NB_CDBK_SIZE_HIGH1,5),a.Pack(i,6),s=5;s<10;s++)r[s]*=2;for(i=LspQuant.Lsp_weight_quant(r,5,f,5,Codebook_Constants.cdbk_nb_high2,Codebook_Constants.NB_CDBK_SIZE_HIGH2,5),a.Pack(i,6),s=0;s<o;s++)r[s]*=97656e-8;for(s=0;s<o;s++)r[s]=e[s]-r[s]}}var m_lsp,filters,submodes,submodeID,first,frameSize,subframeSize,nbSubframes,windowSize,lpcSize,bufSize,min_pitch,max_pitch,gamma1,gamma2,lag_factor,lpc_floor,preemph,pre_mem,frmBuf,frmIdx,excBuf,wbexcBuf,excIdx,innov,lpc,qlsp,old_qlsp,interp_qlsp,interp_qlpc,mem_sp,pi_gain,awk1,awk2,awk3,voc_m1,voc_m2,voc_mean,voc_offset,dtx_enabled,FrameSize,VERY_SMALL=0,NB_FRAME_SIZE=[5,43,119,160,220,300,364,492,79,1,1,1,1,1,1,1],NB_SUBMODES=16,NB_SUBMODE_BITS=4,exc_gain_quant_scal1=[-.35,.05],exc_gain_quant_scal3=[-2.79475,-1.81066,-1.16985,-.848119,-.58719,-.329818,-.063266,.282826];function Nbinit(){submodes=BuildNbSubModes(),submodeID=5,NbCodec_init(160,40,10,640)}function NbCodec_init(e,r,o,a){first=1,this.frameSize=e,this.windowSize=3*e/2,this.subframeSize=r,this.nbSubframes=e/r,this.lpcSize=o,this.bufSize=a,min_pitch=17,max_pitch=144,pre_mem=preemph=0,gamma1=.9,gamma2=.6,lag_factor=.01,lpc_floor=1.0001,frmBuf=new Array,frmIdx=a-windowSize,excBuf=new Array,wbexcBuf=new Array;for(var n=0;n<a;n++)frmBuf[n]=0,excBuf[n]=0,wbexcBuf[n]=0;excIdx=a-windowSize,innov=new Array;for(n=0;n<e;n++)innov[n]=0;lpc=new Array;for(n=0;n<o+1;n++)lpc[n]=0;qlsp=new Array,old_qlsp=new Array,interp_qlsp=new Array;for(n=0;n<o;n++)qlsp[n]=0,old_qlsp[n]=0,interp_qlsp[n]=0;interp_qlpc=new Array;for(n=0;n<o+1;n++)interp_qlpc[n]=0;mem_sp=new Array;for(n=0;n<5*o;n++)mem_sp[n]=0;pi_gain=new Array;for(n=0;n<nbSubframes;n++)pi_gain[n]=0;awk1=new Array,awk2=new Array,awk3=new Array;for(n=0;n<o+1;n++)awk1[n]=0,awk2[n]=0,awk3[n]=0;voc_m1=voc_m2=voc_mean=0,dtx_enabled=voc_offset=0}function BuildNbSubModes(){var e=new Ltp3Tap(Codebook_Constants.gain_cdbk_nb,7,7),r=new Ltp3Tap(Codebook_Constants.gain_cdbk_lbr,5,0),o=new Ltp3Tap(Codebook_Constants.gain_cdbk_lbr,5,7),a=new Ltp3Tap(Codebook_Constants.gain_cdbk_lbr,5,7),n=new LtpForcedPitch,t=new NoiseSearch,i=new SplitShapeSearch(40,10,4,Codebook_Constants.exc_10_16_table,4,0),f=new SplitShapeSearch(40,10,4,Codebook_Constants.exc_10_32_table,5,0),s=new SplitShapeSearch(40,5,8,Codebook_Constants.exc_5_64_table,6,0),_=new SplitShapeSearch(40,8,5,Codebook_Constants.exc_8_128_table,7,0),c=new SplitShapeSearch(40,5,8,Codebook_Constants.exc_5_256_table,8,0),p=new SplitShapeSearch(40,20,2,Codebook_Constants.exc_20_32_table,5,0),u=new NbLspQuant,l=new LbrLspQuant,m=new Array;return m[1]=new SubMode(0,1,0,0,l,n,t,.7,.7,-1,43),m[2]=new SubMode(0,0,0,0,l,r,i,.7,.5,.55,119),m[3]=new SubMode(-1,0,1,0,l,o,f,.7,.55,.45,160),m[4]=new SubMode(-1,0,1,0,l,a,_,.7,.63,.35,220),m[5]=new SubMode(-1,0,3,0,u,e,s,.7,.65,.25,300),m[6]=new SubMode(-1,0,3,0,u,e,c,.68,.65,.1,364),m[7]=new SubMode(-1,0,3,1,u,e,s,.65,.65,-1,492),m[8]=new SubMode(0,1,0,0,l,n,p,.7,.5,.65,79),m}this.m_lsp=new Lsp,this.filters=new Filters,Nbinit();var BandMode=function(){};BandMode.Narrow=0,BandMode.Wide=1,BandMode.UltraWide=2;var pw,HighLspQuant=function(){this.Quant=function(e,r,o,a){var n,t,i=new Array;for(n=0;n<o;n++)r[n]=e[n];for(i[0]=1/(r[1]-r[0]),i[o-1]=1/(r[o-1]-r[o-2]),n=1;n<o-1;n++)i[n]=Math.max(1/(r[n]-r[n-1]),1/(r[n+1]-r[n]));for(n=0;n<o;n++)r[n]-=.3125*n+.75;for(n=0;n<o;n++)r[n]*=256;for(t=LspQuant.Lsp_quant(r,0,Codebook_Constants.high_lsp_cdbk,64,o),a.Pack(t,6),n=0;n<o;n++)r[n]*=2;for(t=LspQuant.Lsp_weight_quant(r,0,i,0,Codebook_Constants.high_lsp_cdbk2,64,o),a.Pack(t,6),n=0;n<o;n++)r[n]*=.0019531;for(n=0;n<o;n++)r[n]=e[n]-r[n]}},Lpc=new function(){this.Wld=function(e,r,o,a){var n,t,i,f=r[0];if(0==r[0]){for(n=0;n<a;n++)o[n]=0;return 0}for(n=0;n<a;n++){for(i=-r[n+1],t=0;t<n;t++)i-=e[t]*r[n-t];for(o[n]=i/=f,e[n]=i,t=0;t<Math.floor(n/2);t++){var s=e[t];e[t]+=i*e[n-1-t],e[n-1-t]+=i*s}n%2!=0&&(e[t]+=e[t]*i),f*=1-i*i}return f},this.Autocorr=function(e,r,o,a){for(var n,t;0<o--;){for(t=o,n=0;t<a;t++)n+=e[t]*e[t-o];r[o]=n}}};function Lsp(){var b;b=new Array,this.Lsp2lpc=function(e,r,o){var a,n,t,i,f,s,_,c,p,u=0,l=o/2;for(a=0;a<4*l+2;a++)b[a]=0;for(s=f=1,n=0;n<=o;n++){var m=0;for(a=0;a<l;a++,m+=2)u=(p=(c=(_=4*a)+1)+1)+1,t=f-2*e[m]*b[_]+b[c],i=s-2*e[m+1]*b[p]+b[u],b[c]=b[_],b[u]=b[p],b[_]=f,b[p]=s,f=t,s=i;t=f+b[u+1],i=s-b[u+2],r[n]=.5*(t+i),b[u+1]=f,b[u+2]=s,s=f=0}}}function Cheb_poly_eva(e,r,o){var a,n,t,i=o>>1;for((t=new Array)[0]=1,t[1]=r,n=e[i]+e[i-1]*r,r*=2,a=2;a<=i;a++)t[a]=r*t[a-1]-t[a-2],n+=e[i-a]*t[a];return n}function Vbr(){var e;Math.pow(6e3,.3),e=new Array;for(var r=0;r<5;r++)e[r]=Math.log(6e3)}pw=new Array,Lsp.prototype.Enforce_margin=Lsp.Enforce_margin=function(e,r,o){var a;for(e[0]<o&&(e[0]=o),e[r-1]>Math.PI-o&&(e[r-1]=Math.PI-o),a=1;a<r-1;a++)e[a]<e[a-1]+o&&(e[a]=e[a-1]+o),e[a]>e[a+1]-o&&(e[a]=.5*(e[a]+e[a+1]-o))},Lsp.prototype.Lpc2lsp=Lsp.Lpc2lsp=function(e,r,o,a,n){var t,i,f,s,_,c,p,u,l,m,b,d,S,w,h,y,z,v,C=0,x=0;for(m=1,l=r/2,d=new Array,y=w=0,z=h=0,(S=new Array)[w++]=1,p=d[h++]=1;p<=l;p++)S[w++]=e[p]+e[r+1-p]-S[y++],d[h++]=e[p]-e[r+1-p]+d[z++];for(p=h=w=0;p<l;p++)S[w]=2*S[w],d[h]=2*d[h],w++,h++;for(s=1,u=_=h=w=0;u<r;u++)for(t=Cheb_poly_eva(v=u%2!=0?d:S,s,r),m=1;1==m&&-1<=_;){var A=n*(1-.9*s*s);if(Math.abs(t)<.2&&(A*=.5),f=_=s-A,(c=Cheb_poly_eva(v,_,r))*t<0){for(x++,i=t,b=0;b<=a;b++)0<(i=Cheb_poly_eva(v,C=(s+_)/2,r))*t?(t=i,s=C):(i,_=C);s=o[u]=C,m=0}else t=c,s=f}return x};var fullFrameSize,foldingGain,high,y0,y1,x0d,g0_mem,g1_mem,wbmodes,wbmodeID,SB_FRAME_SIZE=[4,36,112,192,352,-1,-1,-1],SB_SUBMODES=8,SB_SUBMODE_BITS=3,QMF_ORDER=64;function SbCodec_init(e,r,o,a,n){wbmodes=BuildWbSubModes(),wbmodeID=3,fullFrameSize=2*e,foldingGain=n,lag_factor=.002,high=new Array,y0=new Array,y1=new Array,x0d=new Array,g0_mem=new Array,g1_mem=new Array;for(var t=0;t<fullFrameSize;t++)high[t]=0,y0[t]=0,y1[t]=0;for(t=0;t<e;t++)x0d[t]=0;for(t=0;t<QMF_ORDER;t++)g0_mem[t]=0,g1_mem[t]=0}function BuildWbSubModes(){var e=new HighLspQuant,r=new SplitShapeSearch(40,10,4,Codebook_Constants.hexc_10_32_table,5,0),o=new SplitShapeSearch(40,8,5,Codebook_Constants.hexc_table,7,1),a=new Array;return a[1]=new SubMode(0,0,1,0,e,null,null,.75,.75,-1,36),a[2]=new SubMode(0,0,1,0,e,null,r,.85,.6,-1,112),a[3]=new SubMode(0,0,1,0,e,null,o,.75,.7,-1,192),a[4]=new SubMode(0,0,1,1,e,null,o,.75,.75,-1,352),a}function BuildUwbSubModes(){var e=new HighLspQuant,r=new Array;return r[1]=new SubMode(0,0,1,0,e,null,null,.75,.75,-1,2),r}function NbEncoder(){var B,g,L,I,M,F,q,E,Q,D,P,N,W,O,R,H,Z,G,K,t,V,i,U,r;!function(e,r,o,a){NbCodec_init(e,r,o,a),U=3,0,vad_enabled=0,0,8,submodeSelect=5,L=0,B=1,I=new Array,M=a-windowSize,F=new Array,q=a-windowSize;for(var n=0;n<a;n++)I[n]=0,F[n]=0;E=Window(windowSize,r),P=LagWindow(o,lag_factor),D=new Array;for(var n=0;n<o+1;n++)D[n]=0;Q=new Array;for(var n=0;n<windowSize;n++)Q[n]=0;R=new Array,interp_qlpc=new Array,H=new Array,Z=new Array;for(var n=0;n<o+1;n++)R[n]=0,interp_qlpc[n]=0,H[n]=0,Z[n]=0;N=new Array,qlsp=new Array,W=new Array,old_qlsp=new Array,O=new Array,interp_qlsp=new Array;for(var n=0;n<o;n++)N[n]=0,qlsp[n]=0,W[n]=0,old_qlsp[n]=0,O[n]=0,interp_qlsp[n]=0;G=new Array,mem_sp=new Array,K=new Array,t=new Array,V=new Array;for(var n=0;n<o;n++)G[n]=0,mem_sp[n]=0,K[n]=0,t[n]=0,V[n]=0;new Vbr,0,8e3,awk1=new Array,awk2=new Array,awk3=new Array;for(var n=0;n<o+1;n++)awk1[n]=0,awk2[n]=0,awk3[n]=0;i=new Array;for(var n=0;n<40;n++)i[n]=0;g=new Array;for(var n=0;n<nbSubframes;n++)g[n]=0}(160,40,10,640),this.Encode=function(e,r){var o,a,n,t,i;for(ArrayCopy(frmBuf,frameSize,frmBuf,0,bufSize-frameSize),frmBuf[bufSize-frameSize]=r[0]-preemph*pre_mem,c=1;c<frameSize;c++)frmBuf[bufSize-frameSize+c]=r[c]-preemph*r[c-1];for(pre_mem=r[frameSize-1],ArrayCopy(I,frameSize,I,0,bufSize-frameSize),ArrayCopy(excBuf,frameSize,excBuf,0,bufSize-frameSize),ArrayCopy(F,frameSize,F,0,bufSize-frameSize),c=0;c<windowSize;c++)Q[c]=frmBuf[c+frmIdx]*E[c];for(Lpc.Autocorr(Q,D,lpcSize+1,windowSize),D[0]+=10,D[0]*=lpc_floor,c=0;c<lpcSize+1;c++)D[c]*=P[c];Lpc.Wld(lpc,D,G,lpcSize),ArrayCopy(lpc,0,lpc,1,lpcSize),lpc[0]=1;var f=Lsp.Lpc2lsp(lpc,lpcSize,N,15,.2);if(f==lpcSize)for(c=0;c<lpcSize;c++)N[c]=Math.acos(N[c]);else if(1<U&&(f=Lsp.Lpc2lsp(lpc,lpcSize,N,11,.05)),f==lpcSize)for(c=0;c<lpcSize;c++)N[c]=Math.acos(N[c]);else for(c=0;c<lpcSize;c++)N[c]=W[c];var s;for(c=0;c<lpcSize;c++)(W[c]-N[c])*(W[c]-N[c]);if(0!=first)for(c=0;c<lpcSize;c++)O[c]=N[c];else for(c=0;c<lpcSize;c++)O[c]=.375*W[c]+.625*N[c];for(Lsp.Enforce_margin(O,lpcSize,.002),c=0;c<lpcSize;c++)O[c]=Math.cos(O[c]);for(m_lsp.Lsp2lpc(O,R,lpcSize),0,Filters.Fir_mem2(frmBuf,frmIdx,R,excBuf,excIdx,frameSize,lpcSize,V),c=s=0;c<frameSize;c++)s+=excBuf[excIdx+c]*excBuf[excIdx+c];if(s=Math.sqrt(1+s/frameSize),-1,e.Pack(0,1),e.Pack(submodeID,NB_SUBMODE_BITS),0!=first)for(c=0;c<lpcSize;c++)W[c]=N[c];submodes[submodeID].LsqQuant.Quant(N,qlsp,lpcSize,e),-1!=submodes[submodeID].LbrPitch&&e.Pack(0-min_pitch,7);var _=Math.floor(.5+3.5*Math.log(s));if(_<0&&(_=0),31<_&&(_=31),s=Math.exp(_/3.5),e.Pack(_,5),0!=first)for(c=0;c<lpcSize;c++)old_qlsp[c]=qlsp[c];o=new Array,a=new Array,t=new Array;for(var c=0;c<subframeSize;c++)o[c]=0,a[c]=0,t[c]=0;n=new Array;for(c=0;c<lpcSize;c++)n[c]=0;i=new Array;for(c=0;c<frameSize;c++)i[c]=0;for(c=0;c<frameSize;c++)i[c]=frmBuf[frmIdx+c];for(var p=0;p<nbSubframes;p++){var u,l,m,b,d,S,w,h,y,z;for(m=frmIdx+(l=subframeSize*p),d=excIdx+l,b=q+l,S=M+l,u=(1+p)/nbSubframes,c=0;c<lpcSize;c++)O[c]=(1-u)*W[c]+u*N[c];for(c=0;c<lpcSize;c++)interp_qlsp[c]=(1-u)*old_qlsp[c]+u*qlsp[c];for(Lsp.Enforce_margin(O,lpcSize,.002),Lsp.Enforce_margin(interp_qlsp,lpcSize,.002),c=0;c<lpcSize;c++)O[c]=Math.cos(O[c]);for(m_lsp.Lsp2lpc(O,R,lpcSize),c=0;c<lpcSize;c++)interp_qlsp[c]=Math.cos(interp_qlsp[c]);for(m_lsp.Lsp2lpc(interp_qlsp,interp_qlpc,lpcSize),u=1,c=pi_gain[p]=0;c<=lpcSize;c++)pi_gain[p]+=u*interp_qlpc[c],u=-u;if(Filters.Bw_lpc(gamma1,R,H,lpcSize),0<=gamma2)Filters.Bw_lpc(gamma2,R,Z,lpcSize);else for(Z[0]=1,Z[1]=-preemph,c=2;c<=lpcSize;c++)Z[c]=0;for(c=0;c<subframeSize;c++)excBuf[d+c]=0;for(excBuf[d]=1,Filters.Syn_percep_zero(excBuf,d,interp_qlpc,H,Z,t,subframeSize,lpcSize),c=0;c<subframeSize;c++)excBuf[d+c]=0;for(c=0;c<subframeSize;c++)I[S+c]=0;for(c=0;c<lpcSize;c++)n[c]=mem_sp[c];for(Filters.Iir_mem2(excBuf,d,interp_qlpc,excBuf,d,subframeSize,lpcSize,n),c=0;c<lpcSize;c++)n[c]=K[c];for(Filters.Filter_mem2_b(excBuf,d,H,Z,o,0,subframeSize,lpcSize,n,0),c=0;c<lpcSize;c++)n[c]=K[c];for(Filters.Filter_mem2_b(frmBuf,m,H,Z,F,b,subframeSize,lpcSize,n,0),c=0;c<subframeSize;c++)a[c]=F[b+c]-o[c];for(c=0;c<subframeSize;c++)excBuf[d+c]=I[S+c]=0;for(h=min_pitch,y=max_pitch,0!=B&&l<y&&(y=l),w=submodes[submodeID].Ltp.Quant(a,F,b,interp_qlpc,H,Z,excBuf,d,h,y,0,lpcSize,subframeSize,e,I,S,t,U),g[p]=w,Filters.Syn_percep_zero(excBuf,d,interp_qlpc,H,Z,o,subframeSize,lpcSize),c=0;c<subframeSize;c++)a[c]-=o[c];var v,C,x=0;for(z=p*subframeSize,c=0;c<subframeSize;c++)innov[z+c]=0;for(Filters.Residue_percep_zero(a,0,interp_qlpc,H,Z,Q,subframeSize,lpcSize),c=0;c<subframeSize;c++)x+=Q[c]*Q[c];if(x=Math.sqrt(.1+x/subframeSize),x/=s,0!=submodes[submodeID].HaveSubframeGain)x=Math.log(x),3==submodes[submodeID].HaveSubframeGain?(C=VQ.Index_s(x,exc_gain_quant_scal3,8),e.Pack(C,3),x=exc_gain_quant_scal3[C]):(C=VQ.Index_s(x,exc_gain_quant_scal1,2),e.Pack(C,1),x=exc_gain_quant_scal1[C]),x=Math.exp(x);else x=1;for(v=1/(x*=s),c=0;c<subframeSize;c++)a[c]*=v;for(submodes[submodeID].Innovation.Quantify(a,interp_qlpc,H,Z,lpcSize,subframeSize,innov,z,t,e,U),c=0;c<subframeSize;c++)innov[z+c]*=x;for(c=0;c<subframeSize;c++)excBuf[d+c]+=innov[z+c];for(c=0;c<subframeSize;c++)a[c]*=x;for(c=0;c<lpcSize;c++)n[c]=mem_sp[c];for(Filters.Iir_mem2(excBuf,d,interp_qlpc,frmBuf,m,subframeSize,lpcSize,mem_sp),Filters.Filter_mem2_b(frmBuf,m,H,Z,F,b,subframeSize,lpcSize,K,0),c=0;c<subframeSize;c++)I[S+c]=excBuf[d+c]}if(1<=submodeID){for(c=0;c<lpcSize;c++)W[c]=N[c];for(c=0;c<lpcSize;c++)old_qlsp[c]=qlsp[c]}var A=first=0,k=0;for(c=0;c<frameSize;c++)A+=frmBuf[frmIdx+c]*frmBuf[frmIdx+c],k+=(frmBuf[frmIdx+c]-i[c])*(frmBuf[frmIdx+c]-i[c]);for(10*Math.log((A+1)/(k+1)),r[0]=frmBuf[frmIdx]+preemph*L,c=1;c<frameSize;c++)r[c]=frmBuf[frmIdx+c]+preemph*r[c-1];return L=r[frameSize-1],B=submodes[submodeID].constructor===NoiseSearch||0==submodeID?1:0,1},this.getPiGain=function(){var e=[];return ArrayCopy(pi_gain,0,e,0,pi_gain.length),e},this.getExc=function(){for(var e=new Array,r=0;r<frameSize;r++)e[r]=0;return ArrayCopy(excBuf,excIdx,e,0,frameSize),e},this.getInnov=function(){return innov},this.getMode=function(){r<0&&(r=0);var e=submodeID;return null!=r&&(submodeID=submodeSelect=r),e}}function Window(e,r){var o,a=7*r/2,n=5*r/2,t=new Array;for(o=0;o<a;o++)t[o]=.54-.46*Math.cos(Math.PI*o/a);for(o=0;o<n;o++)t[a+o]=.54+.46*Math.cos(Math.PI*o/n);return t}function LagWindow(e,r){for(var o=new Array,a=0;a<e+1;a++)o[a]=Math.exp(2*Math.PI*r*a*-.5*(2*Math.PI*r*a));return o}function SbEncoder(e){var v,C,x,A,k,i,f,B,g,L,I,M,F,q,E,Q,D,P,N,W,O,R,H,Z,G,K,V,U,T,J,X,Y;e?Uwbinit():(v=new NbEncoder,function(e,r,o,a,n){SbCodec_init(e,r,o,a,n),Y=o,3,8,wbmodeID,C=[],x=[],A=[],k=[],i=[],f=[],F=[],N=[],W=[],O=[],R=[],H=[],Z=[],G=[],K=[],U=[];for(var t=0;t<5*Y;t++)U[t]=0;for(var t=0;t<Y+1;t++)K[t]=0;for(var t=0;t<fullFrameSize;t++)W[t]=0,O[t]=0,R[t]=0;for(var t=0;t<Y;t++)F[t]=0,N[t]=0;for(var t=0;t<e;t++)C[t]=0,H[t]=0;for(var t=0;t<QMF_ORDER;t++)x[t]=0,Z[t]=0,G[t]=0;for(var t=0;t<windowSize;t++)A[t]=0;for(var t=0;t<e;t++)k[t]=0,i[t]=0;for(var t=0;t<r;t++)f[t]=0;B=Window(windowSize,r),g=LagWindow(Y,lag_factor),L=[],I=[],M=[],q=[],[],[],E=[],Q=[],D=[],P=[],J=[],T=[],X=[];for(var t=0;t<Y;t++)L[t]=0,M[t]=0,q[t]=0,D[t]=0,P[t]=0,T[t]=0,J[t]=0;for(var t=0;t<Y+1;t++)I[t]=0,E[t]=0,Q[t]=0,X[t]=0;0,V=1}(160,40,8,640,.9),!1,5),this.Encode=function(e,r){var o,a,n,t,i;for(wbmodeID=1,Filters.Qmf_decomp(r,Codebook_Constants.h0,H,C,fullFrameSize,QMF_ORDER,x),v.Encode(e,H),s=0;s<windowSize-frameSize;s++)W[s]=W[frameSize+s];for(s=0;s<frameSize;s++)W[windowSize-frameSize+s]=C[s];for(ArrayCopy(wbexcBuf,frameSize,wbexcBuf,0,bufSize-frameSize),n=v.getPiGain(),v.getExc(),t=v.getInnov(),i=0==v.getMode()?1:0,s=0;s<windowSize;s++)A[s]=W[s]*B[s];for(Lpc.Autocorr(A,I,Y+1,windowSize),I[0]+=1,I[0]*=lpc_floor,s=0;s<Y+1;s++)I[s]*=g[s];Lpc.Wld(lpc,I,L,Y),ArrayCopy(lpc,0,lpc,1,Y);var f=Lsp.Lpc2lsp(lpc,Y,M,15,.2);if(f!=Y&&(f=Lsp.Lpc2lsp(lpc,Y,M,11,.02))!=Y)for(s=0;s<Y;s++)M[s]=Math.cos(Math.PI*(s+1)/(Y+1));for(s=0;s<Y;s++)M[s]=Math.acos(M[s]);for(s=0;s<Y;s++)(q[s]-M[s])*(q[s]-M[s]);if(e.Pack(1,1),0!=i?e.Pack(0,SB_SUBMODE_BITS):e.Pack(wbmodeID,SB_SUBMODE_BITS),wbmodes[wbmodeID].LsqQuant.Quant(M,F,Y,e),0!=V){for(s=0;s<Y;s++)q[s]=M[s];for(s=0;s<Y;s++)N[s]=F[s]}o=new Array,a=new Array,innov=new Array;for(var s=0;s<lpcSize;s++)o[s]=0;for(s=0;s<lpcSize;s++)a[s]=0,innov[s]=0;for(var _=0;_<nbSubframes;_++){var c,p,u,l,m,b,d,S,w=0,h=0;for(u=excIdx+(l=b=subframeSize*_),m=b,c=(1+_)/nbSubframes,s=0;s<Y;s++)J[s]=(1-c)*q[s]+c*M[s];for(s=0;s<Y;s++)T[s]=(1-c)*N[s]+c*F[s];for(Lsp.Enforce_margin(J,Y,.05),Lsp.Enforce_margin(T,Y,.05),s=0;s<Y;s++)J[s]=Math.cos(J[s]);for(s=0;s<Y;s++)T[s]=Math.cos(T[s]);for(m_lsp.Lsp2lpc(J,X,Y),m_lsp.Lsp2lpc(T,K,Y),Filters.Bw_lpc(gamma1,X,E,Y),Filters.Bw_lpc(gamma2,X,Q,Y),d=S=0,c=1,s=pi_gain[_]=0;s<=Y;s++)S+=c*K[s],c=-c,pi_gain[_]+=K[s];for(d=n[_],d=1/(Math.abs(d)+.01),S=1/(Math.abs(S)+.01),(p=Math.abs(.01+S)/(.01+Math.abs(d)))<5?1:0,0,Filters.Fir_mem2(W,l,K,wbexcBuf,u,subframeSize,Y,D),s=0;s<subframeSize;s++)w+=wbexcBuf[u+s]*wbexcBuf[u+s];if(null==wbmodes[wbmodeID].Innovation){var y;for(s=0;s<subframeSize;s++)h+=t[b+s]*t[b+s];y=w/(.01+h),y=Math.sqrt(y),y*=p;var z=Math.floor(10.5+8*Math.log(y+1e-4));z<0&&(z=0),31<z&&(z=31),e.Pack(z,5),y=.1*Math.exp(z/9.4),y/=p}for(s=0;s<lpcSize;s++)o[s]=U[s];Filters.Iir_mem2(wbexcBuf,u,K,W,l,subframeSize,Y,U),Filters.Filter_mem2_b(W,l,E,Q,k,m,subframeSize,Y,P,0)}for(filters.Fir_mem_up(H,Codebook_Constants.h0,O,fullFrameSize,QMF_ORDER,Z),filters.Fir_mem_up(W,Codebook_Constants.h1,R,fullFrameSize,QMF_ORDER,G),s=0;s<fullFrameSize;s++)r[s]=2*(O[s]-R[s]);for(s=0;s<Y;s++)q[s]=M[s];for(s=0;s<Y;s++)N[s]=F[s];return V=0,1}}function ArrayCopy(e,r,o,a,n){for(var t=e.slice(r,r+n),i=0;i<n;i++)o[a+i]=t[i]}'], {
                    type: "text/javascript"
                })),
                A = function (e) {
                    var r = new Worker(e);
                    r.onmessage = function (e) {
                        V.listen(e.data.volume),
                            R.onVolume(e.data.volume);
                        var r = e.data.buffer
                            , t = new Int16Array(r);
                        m.useVad && F.sendData(t),
                            w.encodeData(t)
                    }
                        ;
                    return {
                        init: function (e) {
                            r.postMessage({
                                command: "init",
                                config: {
                                    sampleRate: e,
                                    outputBufferLength: M.bufferSize
                                }
                            })
                        },
                        reset: function () {
                            r.postMessage({
                                command: "reset"
                            })
                        },
                        sendData: function (e) {
                            r.postMessage({
                                command: "record",
                                buffer: e
                            })
                        }
                    }
                } (m.recordWorkerPath),
                w = function (e) {
                    var t = new Worker(e);
                    t.onmessage = function (e) {
                        if (0 != S && "encode" == e.data.command) {
                            var r = e.data.buffer
                                , t = new Int8Array(r);
                            N.sendData(t.buffer)
                        }
                    }
                        ;
                    return {
                        init: function () {
                            t.postMessage({
                                command: "init"
                            })
                        },
                        encodeData: function (e) {
                            var r = new Int8Array;
                            t.postMessage({
                                command: "encode",
                                inData: e,
                                inOffset: 0,
                                inCount: e.length,
                                outData: r,
                                outOffset: 0
                            })
                        }
                    }
                } (m.speexWorkerPath),
                m.useVad && (F = function (e) {
                    var r = new Worker(e);
                    r.onmessage = function (e) {
                        "esvad" == e.data.command && "end" == e.data.message && B.getResult()
                    }
                        ;
                    return {
                        init: function () {
                            r.postMessage({
                                command: "init"
                            })
                        },
                        sendData: function (e) {
                            r.postMessage({
                                command: "appendData",
                                pcmData: e,
                                nSamples: e.length
                            })
                        }
                    }
                } (m.vadWorkerPath)),
                r = m.serverUrl,
                n = !(t = null),
                s = "",
                a = {
                    onSSB: function (e) {
                        0 == e.ret ? (l.id = e.data.sid,
                            R.onProcess("started")) : (B.abortSession(),
                                R.onResult(e.ret, null))
                    },
                    onGRS: function (e) {
                        if (d == I.getResult) {
                            var r = e.ret;
                            if (0 != r)
                                return B.abortSession(),
                                    void R.onResult(r, null);
                            if ("nlp" == C) {
                                var t = function (e) {
                                    if (null == e)
                                        return null;
                                    var r = JSON.parse(e);
                                    if (0 != r.rc) {
                                        var t = "";
                                        return t = 4 == r.rc ? "语法匹配失败" : r.error.message,
                                            {
                                                ret: r.rc,
                                                msg: t
                                            }
                                    }
                                    var n = JSON.parse(r.answer.text);
                                    try {
                                        return {
                                            ret: 0,
                                            data: JSON.parse(n.text),
                                            type: "json"
                                        }
                                    } catch (e) {
                                        return {
                                            ret: 0,
                                            data: n.text,
                                            type: "string"
                                        }
                                    }
                                } (e.data.nlprst);
                                R.onResult(r, e.data.iatrst, t),
                                    s = "",
                                    d = I.sessionEnd,
                                    z()
                            } else {
                                var n = e.data.rss
                                    , a = e.data.iatrst
                                    , o = function (e) {
                                        null != e && null != e && (s += e)
                                    };
                                5 == n ? (o(a),
                                    R.onResult(r, s),
                                    s = "",
                                    d = I.sessionEnd,
                                    z()) : (o(a),
                                        B.getResult())
                            }
                        } else
                            x.log("GET RESULT ERROR.")
                    },
                    onSSE: function () {
                        l.id = null,
                            R.onProcess("onEnd")
                    }
                },
                o = function () { }
                ,
                i = function () {
                    g.sessionBegin()
                }
                ,
                c = function (e) {
                    var r = JSON.parse(e.data)
                        , t = r.cmd;
                    if ("ssb" == t)
                        a.onSSB(r);
                    else if ("grs" == t)
                        a.onGRS(r);
                    else if ("sse" == t)
                        a.onSSE(r);
                    else {
                        var n = r.ret;
                        if (0 == n)
                            return;
                        B.abortSession(),
                            R.onResult(n, null)
                    }
                }
                ,
                _ = function () {
                    R.onError("connectError"),
                        B.abortSession()
                }
                ,
                f = function () {
                    t.onclose = o,
                        t.onopen = i,
                        t.onmessage = c,
                        t.onerror = _
                }
                ,
                (y = {
                    preConnect: function () {
                        t = new WebSocket(r)
                    },
                    connect: function () {
                        n && (f(),
                            n = !1),
                            null == t || 1 != t.readyState ? (t = new WebSocket(r),
                                f()) : g.sessionBegin()
                    },
                    send: function (e) {
                        x.log(e),
                            t.send(JSON.stringify(e))
                    }
                }).preConnect(),
                this.start = function (e) {
                    v = [],
                        C = x.checkParam("openqa_db", e.params) ? "nlp" : null,
                        b = e.params + ", rse = utf8, browser_id=" + M.browserId + ",host=" + M.host,
                        B.startRecord()
                }
                ,
                this.stop = function () {
                    B.getResult()
                }
                ,
                this.cancel = function () {
                    B.abortSession()
                }
                ,
                this.getData = function () {
                    return new Blob(v, {
                        type: "audio/speex-wb"
                    })
                }
                ,
                this.kill = function () {
                    if (null != E) {
                        for (var e = E.getAudioTracks(), r = 0; r < e.length; r++)
                            e[r].stop();
                        E = null
                    }
                    null != h.source && (h.source.disconnect(),
                        h.scriptNode.disconnect(),
                        h.source = null,
                        h.scriptNode = null)
                }
            )
    }
} (window, navigator);